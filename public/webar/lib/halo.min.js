!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.Halo={})}(this,function(t){"use strict";function e(t){t?Object.assign(this,t):(this.min=this.max=1,this.name="init_abs_scale")}function i(t){t?Object.assign(this,t):(this.yMin=this.yMax=this.rMin=this.rMax=1,this.name="init_angle_speed")}function s(t){t?Object.assign(this,t):(this.min_x=this.min_y=this.min_z=this.max_x=this.max_y=this.max_z=0,this.name="init_box")}function r(t){t?Object.assign(this,t):(this.min_r=this.min_g=this.min_b=this.min_a=this.max_r=this.max_g=this.max_b=this.max_a=1,this.name="init_color_range")}function a(t){t?Object.assign(this,t):(this.min_r=1,this.max_r=2,this.min_h=0,this.max_h=1,this.name="init_ring")}function n(t){t?Object.assign(this,t):(this.min_rs=this.max_rs=this.min_ts=this.max_ts=this.min_ys=this.max_ys=0,this.name="init_ring_speed")}function o(t){t?Object.assign(this,t):(this.min_rot=this.min_spin=this.max_rot=this.max_spin=0,this.name="init_rotation")}function h(t){t?Object.assign(this,t):(this.min_x=this.min_y=this.max_x=this.max_y=0,this.name="init_scale_xy")}function c(t){t?Object.assign(this,t):(this.rad=1,this.tan=0,this.name="aff_accel_ring")}function l(t){t?Object.assign(this,t):(this.t=[],this.r=[],this.g=[],this.b=[],this.a=[],this.name="aff_color")}function d(t){t?Object.assign(this,t):(this.gx=this.gy=this.gz=0,this.name="aff_gravity")}function u(t){t?Object.assign(this,t):(this.damping=1,this.ground=0,this.name="aff_rebounce")}function p(t){t?Object.assign(this,t):(this.t=[],this.x=[],this.y=[],this.name="aff_scale")}function f(t){t?Object.assign(this,t):(this.sx=this.sy=1,this.name="aff_scale_add")}function m(t){Object.assign(this,t);for(var e=0,i=this.inis.length;e!==i;++e){var s=this.inis[e];this.inis[e]=new B[s.name](s)}for(var r=0,a=this.affs.length;r!==a;++r){var n=this.affs[r];this.affs[r]=new W[n.name](n)}}function v(){this.enable=!0,this.visible=!0,this.parent=null,this.children=[],this.name="",this.type="Widget",this._anchorH=G,this._anchorV=N,this.zIndex=10,this.z=1e4,this._dirty=!0,this.alpha=1,this.worldAlpha=1,this.scale=1,this.scissorID=-1,this._formulaOffsetX="0",this._formulaOffsetY="0",this.formulaOffsetXFunc=new Function("w","h","return 0;"),this.formulaOffsetYFunc=new Function("w","h","return 0;"),this._formulaSizeX="100",this._formulaSizeY="100",this.formulaSizeXFunc=new Function("w","h","return 100;"),this.formulaSizeYFunc=new Function("w","h","return 100;"),this.size=new THREE.Vector2(100,100),this.dimension=new THREE.Box2,this.dimension.min.set(0,0),this.dimension.max.set(100,100)}function g(t,e){v.call(this),this.type="WtImage",this._srcFactor=THREE.SrcAlphaFactor,this._dstFactor=THREE.OneMinusSrcAlphaFactor,this._atlas=Halo.ResourceManager.getSimpleSprite(t,e)||Halo.ResourceManager.defaultSimpleSprite,this.image=t,this.sprite=e,this.color=new THREE.Color(1,1,1)}function y(t,e){g.call(this,t,e),this.type="WtButton",this.pressedScale=.95,this._pressed=!1,this._onClickFunc=null,this._onClick="",this.addEventListener(Z,function(t){this._pressed=!0,this.setScale(this.pressedScale),t.stop=!0}),this.addEventListener(q,function(t){if(this._pressed){if(this.dimension.containsPoint(t))try{this._onClickFunc&&this._onClickFunc(this)}catch(t){console.log(t)}this._pressed=!1,this.setScale(1)}})}function x(t,e,i,s,r,a){this.texture=t,this.sprite=e,this.x1=65535*i,this.y1=65535*s,this.x2=65535*(i+r),this.y2=65535*(s-a)}function E(t){v.call(this),this.type="WtText",this.color=new THREE.Color(0,0,0),this.font="20px Arial",this.auto_break=!1,this.text_align=G,this.line_gap=0,this.text=t||"",this._srcFactor=THREE.SrcAlphaFactor,this._dstFactor=THREE.OneMinusSrcAlphaFactor,this.lines=[],this.max_width=-1}function b(t,e){g.call(this,t,e),this.type="WtPanel",this.core=b.DEFAULT_CORE.clone(),this.boarder=b.DEFAULT_BOARDER.clone()}function w(t,e){g.call(this,t,e),this.type="WtProgressBar",this.progress=1,this.horizontal=!0,this.reversed=!1}function _(){v.call(this),this.type="WtScrollView",this.horizontal=!1,this._position=0,this._pressed=!1,this._mark=0,this._length=0,this._moved=!1,this.addEventListener(Z,function(t){this._pressed=!0,this._mark=this.horizontal?t.x:t.y,t.stop=!0}),this.addEventListener(J,function(t){if(this._pressed){var e=this.horizontal?t.x:t.y;this._position+=e-this._mark,this._mark=e,this._moved=!0}}),this.addEventListener(q,function(t){this._pressed&&(this._pressed=!1)})}function T(t,e){v.call(this),this.type="WtGridView",this.nColumn=4,this.horizontal=!0,this.gridHeight=100,this.gridWidth=100,this.gapX=0,this.gapY=0,this.reverseX=!1,this.reverseY=!1}function R(t,e){b.call(this,t,e),this.type="WtDialog",this._onCloseFunc=null,this._onClose="",this.addEventListener(q,function(t){this.dimension.containsPoint(t)||this.close()})}function M(t,e,i,s,r,a){this.a=t||1,this.b=e||0,this.c=i||0,this.d=s||1,this.tx=r||0,this.ty=a||0}function S(){this.worldTransform=new M,this.localTransform=new M,this._worldID=0,this._parentID=0,this.position=new THREE.Vector2(0,0),this.scale=new THREE.Vector2(1,1),this.skew=new THREE.Vector2(0,0),this.pivot=new THREE.Vector2(0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1}function H(){this.transform=new S,this.alpha=1,this.worldAlpha=1,this.visible=!0,this.parent=null,this.children=[],this.z=0}function A(){v.call(this),this.type="WtObject2D",this.obj2d=new H,this.center=new THREE.Vector2}function O(){THREE.ShaderMaterial.call(this,{vertexShader:$.uv_animation,fragmentShader:tt.uv_animation,uniforms:{uTimer:{value:0},uSpeed:{value:new THREE.Vector2(.1,.1)},uRepeat:{value:new THREE.Vector2(1,1)},tSprite:{value:L},opacity:{value:1}}}),this.transparent=!1,Object.defineProperties(this,{opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(t){this.uniforms.opacity.value=t}}}),this.active=!0}function D(){THREE.ShaderMaterial.call(this,{vertexShader:$.uv_animation,fragmentShader:tt.uv_frame,uniforms:{uTimer:{value:0},uFrames:{value:4},uCols:{value:2},uFPS:{value:20},tSprite:{value:L},opacity:{value:1}}}),this.transparent=!1,Object.defineProperties(this,{opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(t){this.uniforms.opacity.value=t}}}),this.active=!0}function F(){THREE.ShaderMaterial.call(this,{vertexShader:$.halo,fragmentShader:tt.halo,uniforms:{uDistance:{value:.2},uConst:{value:.1},uPower:{value:3},tSprite:{value:L}}}),this.transparent=!0}function j(t){this.index=t||0,this.position=new THREE.Vector3,this.velocity=new THREE.Vector3,this.birthScale=new THREE.Vector2(1,1),this.scale=new THREE.Vector2(1,1),this.color=new THREE.Color(1,1,1),this.alpha=1,this.rotation=0,this.spin=0,this.timer=0,this.ratio=0,this.life=0,this.frameIdx=0,this.setActive=function(t){t?(this.spin=this.rotation=this.ratio=this.timer=0,this.scale.set(1,1),this.birthScale.set(1,1),this.color.setRGB(1,1,1),this.alpha=1,this.position.set(0,0,0),this.velocity.set(0,0,0)):(this.scale.set(0,0),this.alpha=0)}}function C(t,e){THREE.BufferGeometry.call(this),this.template=e;var i=e.count;this.attrPosition=new THREE.BufferAttribute(new Float32Array(12*i),3).setDynamic(!0),this.attrRotation=new THREE.BufferAttribute(new Float32Array(4*i),1).setDynamic(!0),this.attrColor=new THREE.BufferAttribute(new Uint8Array(16*i),4).setDynamic(!0),this.attrScale=new THREE.BufferAttribute(new Float32Array(8*i),2).setDynamic(!0),this.attrUV=new THREE.BufferAttribute(new Uint16Array(8*i),2).setDynamic(!0),this.attrColor.normalized=!0,this.attrUV.normalized=!0,this.addAttribute("position",this.attrPosition),this.addAttribute("rotation",this.attrRotation),this.addAttribute("color",this.attrColor),this.addAttribute("scale",this.attrScale),this.addAttribute("uv",this.attrUV);for(var s=[],r=0;r!=i;++r){var a=4*r;s.push(a,a+1,a+2,a,a+2,a+3)}if(this.setIndex(s),this.sprites=[],e.image&&e.sprites&&e.sprites.length>0)for(var n=0,o=e.sprites.length;n!==o;++n)this.sprites.push(Halo.ResourceManager.getSimpleSprite(e.image,e.sprites[n]));else this.sprites.push(Halo.ResourceManager.defaultSimpleSprite);this.blend=X.BLENDS[e.blend];var h=t?e.z_up?"z_up_global":"global":e.z_up?"z_up_local":"local";this.shaderIdx=X.shaders.indexOf(h),this.shaderIdx<0&&(this.shaderIdx=255)}function z(t,e){THREE.BufferGeometry.call(this),this.template=e;var i=e.count;this.attrPosition=new THREE.BufferAttribute(new Float32Array(12*i),3).setDynamic(!0),this.attrVelocity=new THREE.BufferAttribute(new Float32Array(12*i),3).setDynamic(!0),this.attrColor=new THREE.BufferAttribute(new Uint8Array(16*i),4).setDynamic(!0),this.attrScale=new THREE.BufferAttribute(new Float32Array(8*i),2).setDynamic(!0),this.attrUV=new THREE.BufferAttribute(new Uint16Array(8*i),2).setDynamic(!0),this.attrColor.normalized=!0,this.attrUV.normalized=!0,this.addAttribute("position",this.attrPosition),this.addAttribute("velocity",this.attrVelocity),this.addAttribute("color",this.attrColor),this.addAttribute("scale",this.attrScale),this.addAttribute("uv",this.attrUV);for(var s=[],r=0;r!=i;++r){var a=4*r;s.push(a,a+1,a+2,a,a+2,a+3)}if(this.setIndex(s),this.sprites=[],e.image&&e.sprites&&e.sprites.length>0)for(var n=0,o=e.sprites.length;n!==o;++n)this.sprites.push(Halo.ResourceManager.getSimpleSprite(e.image,e.sprites[n]));else this.sprites.push(Halo.ResourceManager.defaultSimpleSprite);this.blend=X.BLENDS[e.blend];var h=t?"arrow_global":"arrow_local";this.shaderIdx=X.shaders.indexOf(h),this.shaderIdx<0&&(this.shaderIdx=255)}function X(t){var e=new X.RENDERERS[t.renderer.name](t.global,t.renderer),i=X.getMaterial(e.getMatCfg());THREE.Mesh.call(this,e,i),this.template=t,this.type="ParticleSystem",this.name=t.name,this.timer=0,this.mark=0,this.emitting=!1,this.fractionEmitNum=0,this.particles=[],this.position.fromArray(t.pos),this.rotation.fromArray(t.rot),this.scale.fromArray(t.sca),this.drawMode=THREE.TrianglesDrawMode}function U(t){THREE.Object3D.call(this),this.type="Effect",this.name=t,this.timer=0,this.active=!1,this.template=Q.getEffect(t),this.maxDelay=0;for(var e=0;e!==this.template.length;++e){var i=this.template[e],s=new X(i);this.add(s),this.maxDelay=Math.max(this.maxDelay,i.delay)}}function I(){function t(t,e){s=t,r=e;var i=new THREE.BufferGeometry,a=new THREE.BufferAttribute(new Float32Array(3*t),3).setDynamic(!0),n=new THREE.BufferAttribute(new Uint8Array(4*t),4).setDynamic(!0),o=new THREE.BufferAttribute(new Uint16Array(2*t),2).setDynamic(!0),h=new THREE.BufferAttribute(new Uint16Array(e),1).setDynamic(!0);return n.normalized=!0,o.normalized=!0,i.addAttribute("position",a),i.addAttribute("color",n),i.addAttribute("uv",o),i.setIndex(h),i}function e(t){var e=(t.texture.id<<16)+(t.srcFactor<<4)+t.dstFactor-3400;return t.enable&&(e+=256),t.scissorID>=0&&(e+=t.scissorID+1<<9),e}function i(t){var e=new THREE.ShaderMaterial({transparent:!0,depthWrite:!1,blending:THREE.CustomBlending,blendEquation:THREE.AddEquation,blendSrc:t.srcFactor,blendDst:t.dstFactor,vertexShader:I.SHADER_2D.vertex,fragmentShader:t.enable?I.SHADER_2D.fragment:I.SHADER_2D.disabale,uniforms:{tSprite:{value:t.texture},uPMVMatrix:{value:I.PMV_MATRIX}}});return e.scissorID=t.scissorID,e.needsUpdate=!0,e}THREE.Scene.call(this),this._ratio=1,this._invRatio=1,this._spriteRoot=new H,this._widgetRoot=new v,this._widgetRoot.setSize(1920,1080),this._widgets=[];var s=0,r=0,a=t(2,4),n=null;this._genRenderMesh=function(){var o=[];this._spriteRoot.render(o),this._widgetRoot.render(o);for(var h=0,c=0,l=0,d=o.length;l!==d;++l)h+=(x=o[l]).getVertexCount(),c+=x.getIndexCount();if(h>s||c>r){for(;s<h;)s*=2;for(;r<c;)r*=2;a=t(s,r)}var u=a.getAttribute("position"),p=a.getAttribute("color"),f=a.getAttribute("uv");a.clearGroups();for(var m=0,g=0,y=null,l=0,d=o.length;l!==d;++l){var x=o[l],E=x.getMatCfg(),b=e(E),w=I.materials[b];w||(w=i(E),I.materials[b]=w,I.matqueue.push(w));var _=I.matqueue.indexOf(w);null===y?(a.addGroup(0,0,_),y=a.groups[0]):y.materialIndex!==_&&(a.addGroup(g,0,_),y=a.groups[a.groups.length-1]),x.updatePosition(u,m),x.updateColor(p,m),x.updateUV(f,m),x.updateIndex(a.index,g,m),m+=x.getVertexCount(),g+=x.getIndexCount(),y.count=g-y.start}(m>0||g>0)&&(u.updateRange.offset=p.updateRange.offset=f.updateRange.offset=a.index.updateRange.offset=0,u.updateRange.count=3*m,p.updateRange.count=4*m,f.updateRange.count=2*m,a.index.updateRange.count=g,u.needsUpdate=p.needsUpdate=f.needsUpdate=a.index.needsUpdate=!0),null===n?((n=new THREE.Mesh(a,I.matqueue)).name="HALO2D",n.renderOrder=1e3,n.frustumCulled=!1,this.add(n),n.onBeforeRender=function(t,e,i,s,r,a){if(r.scissorID>=0){var n=t.getPixelRatio()*e._invRatio,o=v.scissors[r.scissorID],h=o.min.x*n,c=o.min.y*n,l=o.max.x*n-h,d=o.max.y*n-c;t.setScissor(h,c,l,d),t.setScissorTest(!0)}else t.setScissorTest(!1)},n.onAfterRender=function(t,e,i,s,r,a){t.setScissorTest(!1)}):(n.geometry=a,n.material=I.matqueue)}}function V(){return new Promise(function(t,e){var i=it.getUrl("","version.json"),s=new XMLHttpRequest;s.onreadystatechange=function(){s.readyState===XMLHttpRequest.DONE&&(200===s.status?t(s.responseText):e(i))},s.open("GET",i,!0),s.responseType="text",s.send()})}function P(){H.call(this),this._atlas=null,this._anchor=new THREE.Vector2(0,0),this._srcFactor=THREE.SrcAlphaFactor,this._dstFactor=THREE.OneMinusSrcAlphaFactor,this.color=new THREE.Color(1,1,1)}var Y=function(){var t=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB;if(void 0===t)return console.warn("Storage: IndexedDB not available."),{init:function(){},get:function(){},set:function(){}};var e=null;return{init:function(i){return new Promise(function(s,r){var a=t.open(i,1);a.onupgradeneeded=function(t){var e=t.target.result;!1===e.objectStoreNames.contains("assets")&&e.createObjectStore("assets",{keyPath:"url"})},a.onsuccess=function(t){e=t.target.result,s()},a.onerror=function(t){console.error("IndexedDB",t),r()}})},get:function(t,i){e.transaction(["assets"],"readwrite").objectStore("assets").get(t).onsuccess=function(t){i(t.target.result)}},set:function(t,i,s){performance.now();e.transaction(["assets"],"readwrite").objectStore("assets").add({url:t,data:i,version:s}).onsuccess=function(e){console.log("IndexedDB save data: "+t)}}}}(),k=function(){for(var t=2*Math.PI,e=.5*Math.PI,i=[],s=0;4096!==s;++s)i.push(Math.random());for(var r=0,a=[],n=0;360!==n;++n)a.push(Math.sin(n*THREE.Math.DEG2RAD));for(var o=[],h=0;360!==h;++h)o.push(Math.cos(h*THREE.Math.DEG2RAD));var c="0123456789abcdefghijklmnopqrstuvwxyz",l=function(t){t=t||12;for(var e="",i=0;i<t;i++)e+=c[Math.floor(Math.random()*c.length)];return e};return{TWO_PI:t,HALF_PI:e,rand:function(){return 4095==r++&&(r=0),i[r]},randFloat:function(t,e){return t+k.rand()*(e-t)},randInt:function(t,e){return t+Math.floor(k.rand()*(e-t))},sin:function(t){var e=Math.floor(t*THREE.Math.RAD2DEG%360);return e<0&&(e+=360),a[e]},cos:function(t){var e=Math.floor(t*THREE.Math.RAD2DEG%360);return e<0&&(e+=360),o[e]},sincos:function(t){var e=Math.floor(t*THREE.Math.RAD2DEG%360);return e<0&&(e+=360),{sin:a[e],cos:o[e]}},hashCode:function(t){return t.split("").reduce(function(t,e){return(t=(t<<5)-t+e.charCodeAt(0))&t},0)},genName:function(t){return l(t)}}}();Object.assign(e.prototype,{init:function(t){t.birthScale.multiplyScalar(k.randFloat(this.min,this.max)),t.scale.copy(t.birthScale)}}),Object.assign(i.prototype,{init:function(t){var e=k.randFloat(0,k.TWO_PI),i=k.randFloat(this.rMin,this.rMax),s=i*k.sin(e),r=i*k.cos(e),a=k.randFloat(this.yMin,this.yMax);t.velocity.set(s,a,r)}}),Object.assign(s.prototype,{init:function(t){t.position.x=k.randFloat(this.min_x,this.max_x),t.position.y=k.randFloat(this.min_y,this.max_y),t.position.z=k.randFloat(this.min_z,this.max_z)}}),Object.assign(r.prototype,{init:function(t){t.color.r=k.randFloat(this.min_r,this.max_r),t.color.g=k.randFloat(this.min_g,this.max_g),t.color.b=k.randFloat(this.min_g,this.max_b),t.alpha=k.randFloat(this.min_a,this.max_a)}}),Object.assign(a.prototype,{init:function(t){var e=k.randFloat(this.min_r,this.max_r),i=k.randFloat(0,k.TWO_PI),s=k.randFloat(this.min_h,this.max_h),r=k.sincos(i);t.position.set(e*r.sin,s,e*r.cos)}}),Object.assign(n.prototype,{init:function(t){var e=t.position.x,i=t.position.z,s=e*e+i*i;if(s>0){var r=1/Math.sqrt(s),a=k.randFloat(this.min_rs,this.max_rs)*r,n=k.randFloat(this.min_ts,this.max_ts)*r;t.velocity.x=e*a-i*n,t.velocity.z=i*a+e*n,t.velocity.y=k.randFloat(this.min_ys,this.max_ys)}}}),Object.assign(o.prototype,{init:function(t){t.rotation=k.randFloat(this.min_rot,this.max_rot),t.spin=k.randFloat(this.min_spin,this.max_spin)}}),Object.assign(h.prototype,{init:function(t){t.scale.x=t.birthScale.x*k.randFloat(this.min_x,this.max_x),t.scale.y=t.birthScale.y*k.randFloat(this.min_y,this.max_y)}}),Object.assign(c.prototype,{affect:function(t,e){var i=t.position.x,s=t.position.z,r=i*i+s*s;if(r>0){var a=1/Math.sqrt(r),n=i*a,o=s*a,h=this.rad*e,c=this.tan*e;t.velocity.x+=n*h-o*c,t.velocity.z+=o*h+n*c}else{var l=k.randFloat(0,k.TWO_PI);t.velocity.x+=k.cos(l)*this.rad*e,t.velocity.z+=k.sin(l)*this.rad*e}}}),Object.assign(l.prototype,{affect:function(t,e){for(var i=0,s=t.color.r,r=t.color.g,a=t.color.b,n=t.alpha,o=0,h=this.t.length;o<h;++o){var c=this.t[o],l=this.r[o],d=this.g[o],u=this.b[o],p=this.a[o];if(i<=t.ratio&&t.ratio<c){var f=(t.ratio-i)/(c-i),m=s*(1-f)+l*f,v=r*(1-f)+d*f,g=a*(1-f)+u*f;t.alpha=n*(1-f)+p*f,t.color.setRGB(m,v,g);break}i=c,s=l,r=d,a=u,n=p}}}),Object.assign(d.prototype,{affect:function(t,e){t.velocity.x+=this.gx*e,t.velocity.y+=this.gy*e,t.velocity.z+=this.gz*e}}),Object.assign(u.prototype,{affect:function(t,e){t.position.y<this.ground&&(t.velocity.x*=this.damping,t.velocity.y*=-this.damping,t.velocity.z*=this.damping,t.position.y=this.ground)}}),Object.assign(p.prototype,{affect:function(t,e){for(var i=0,s=t.scale.x,r=t.scale.y,a=0,n=this.t.length;a<n;++a){var o=this.t[a],h=this.x[a],c=this.y[a];if(i<=t.ratio&&t.ratio<o){var l=(t.ratio-i)/(o-i),d=s*(1-l)+h*l,u=r*(1-l)+c*l;t.scale.set(d,u);break}i=o,s=h,r=c}}}),Object.assign(f.prototype,{affect:function(t,e){t.scale.x+=this.sx*e,t.scale.y+=this.sy*e}});var B={init_abs_scale:e,init_angle_speed:i,init_box:s,init_color_range:r,init_ring:a,init_ring_speed:n,init_rotation:o,init_scale_xy:h},W={aff_accel_ring:c,aff_color:l,aff_gravity:d,aff_rebounce:u,aff_scale:p,aff_scale_add:f};Object.assign(m.prototype,{isEmissionOver:function(t){return t>this.duration&&this.repeatDelay>=1e3},getEmitNum:function(t,e,i,s){var r=this.duration+this.repeatDelay;(t-=r*Math.floor(t/r))>this.duration&&(s=0,(e=this.duration-t+e)<=0&&(e=0));var a=s+this.emissionRate*e,n=Math.floor(a);return n>i&&(n=i),s=a-n,{num:n,fraction:s}},isAutoStop:function(){return this.duration<1e3&&this.repeatDelay>=1e3&&this.lifeMin<1e3&&this.lifeMax<1e3},init:function(t){t.setActive(!0),t.life=k.randFloat(this.lifeMin,this.lifeMax),t.scale.fromArray(this.absScale),t.birthScale.fromArray(this.absScale);for(var e=0,i=this.inis.length;e!==i;++e)this.inis[e].init(t)},affect:function(t,e){for(var i=0,s=this.affs.length;i!==s;++i)this.affs[i].affect(t,e);t.position.addScaledVector(t.velocity,e),t.rotation+=t.spin*e},doFadeout:function(t,e){return this.fadeout>0&&(t.alpha-=this.fadeout*e,t.alpha<0)&&(t.alpha=0,!0)}});var L=new THREE.Texture(THREE.Texture.DEFAULT_IMAGE),G=1,N=4,Z=1,q=2,J=3;Object.assign(v.prototype,THREE.EventDispatcher.prototype,{isWidget:!0,render:function(t){var e=this.parent?this.parent.dimension:this.dimension;if(this.visible&&e.intersectsBox(this.dimension))for(var i=0,s=this.children.length;i<s;i++)this.children[i].render(t)},propogateEvent:function(t){(t.type!==Z||this.dimension.containsPoint(t))&&this.dispatchEvent(t),!t.stop&&this.parent&&this.parent.propogateEvent(t)},captureEvent:function(t){if(this.enable){var e=!1;if(this.children.length>0)for(var i=0,s=this.children.length;i<s;i++){var r=this.children[i].captureEvent(t);e=e||r}return e||this.propogateEvent(t),!0}return!1},setAnchorType:function(t,e){this._anchorH=t,this._anchorV=e,this._dirty=!0},setFormulaOffsetX:function(t){this._formulaOffsetX=t;try{this.formulaOffsetXFunc=new Function("w","h","return "+t+";"),this._dirty=!0}catch(t){alert(t)}},setFormulaOffsetY:function(t){this._formulaOffsetY=t;try{this.formulaOffsetYFunc=new Function("w","h","return "+t+";"),this._dirty=!0}catch(t){alert(t)}},setFormulaSizeX:function(t){this._formulaSizeX=t;try{this.formulaSizeXFunc=new Function("w","h","return "+t+";"),this._dirty=!0}catch(t){alert(t)}},setFormulaSizeY:function(t){this._formulaSizeY=t;try{this.formulaSizeYFunc=new Function("w","h","return "+t+";"),this._dirty=!0}catch(t){alert(t)}},setOffset:function(t,e){this.setFormulaOffsetX(t),this.setFormulaOffsetY(e)},setSize:function(t,e){this.setFormulaSizeX(t),this.setFormulaSizeY(e)},add:function(t){if(t===this)return console.error("Halo.Widget.add: widget can't be added as a child of itself.",t),this;t&&t.isWidget?(null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),this._dirty=!0):console.error("Halo.Widget.add: widget not an instance of Halo.Object2D.",t)},remove:function(t){var e=this.children.indexOf(t);-1!==e&&(t.parent=null,this.children.splice(e,1))},traverse:function(t){if(this.visible){t(this);for(var e=0,i=this.children.length;e<i;e++)this.children[e].traverse(t)}},getChild:function(t){for(var e=0;e!==this.children.length;++e){var i=this.children[e];if(i.name===t)return i}return null},enableScissor:function(t){this.scissorID=t;for(var e=0;e!==this.children.length;++e)this.children[e].enableScissor(t)},disableScissor:function(){this.scissorID=-1;for(var t=0;t!==this.children.length;++t)this.children[t].disableScissor(-1)},setEnable:function(t){this.enable=t;for(var e=0;e!==this.children.length;++e)this.children[e].setEnable(t)},setScale:function(t){this.scale=t;for(var e=0;e!==this.children.length;++e)this.children[e].setScale(t)},doRelayout:function(){var t=0,e=0;this.parent&&(t=this.parent.size.x,e=this.parent.size.y);var i,s;try{i=this.formulaOffsetXFunc(t,e),s=this.formulaOffsetYFunc(t,e),this.size.x=this.formulaSizeXFunc(t,e),this.size.y=this.formulaSizeYFunc(t,e)}catch(t){console.error("Formula error:",this._formulaOffsetX,this._formulaOffsetY,this._formulaSizeX,this._formulaSizeY),i=s=0,this.size.set(100,100)}if(this.parent){var r=this.parent.dimension,a=0,n=0;this._anchorH===G?a=r.min.x+i:2===this._anchorH?a=.5*(r.min.x+r.max.x-this.size.x)+i:3===this._anchorH&&(a=r.max.x-this.size.x-i),this._anchorV===N?n=r.max.y-this.size.y-s:5===this._anchorV?n=.5*(r.min.y+r.max.y-this.size.y)+s:6===this._anchorV&&(n=r.min.y+s);var o=a+this.size.x,h=n+this.size.y;this.dimension.min.set(a,n),this.dimension.max.set(o,h)}else this.dimension.min.set(i,s),this.dimension.max.set(i+this.size.x,s+this.size.y);this._dirty=!1},relayout:function(t){if(this.visible){this.parent?(this.worldAlpha=this.alpha*this.parent.worldAlpha,this.z=this.parent.z+this.zIndex):this.worldAlpha=this.alpha,(t=t||this._dirty)&&this.doRelayout();for(var e=0,i=this.children.length;e<i;e++)this.children[e].relayout(t)}},encode:function(){var t={class:this.type,children:[]};this.name&&this.name!==this.type&&(t.name=this.name),1!==this.zIndex&&(t.zIndex=this.zIndex),1!==this.alpha&&(t.alpha=this.alpha),this._anchorH===G&&this._anchorV===N||(t.anchor={x:this._anchorH,y:this._anchorV}),this._formulaOffsetX&&(t.offsetX=this._formulaOffsetX),this._formulaOffsetY&&(t.offsetY=this._formulaOffsetY),this._formulaSizeX&&(t.sizeX=this._formulaSizeX),this._formulaSizeY&&(t.sizeY=this._formulaSizeY),this.enable||(t.enable=!1);for(var e=0;e!==this.children.length;++e)t.children.push(this.children[e].encode());return t}}),Object.assign(v,{decode:function(t,e){(e=e||new v).name=t.name||t.class,e.visible=!1!==t.visible,void 0!==t.zIndex&&(e.zIndex=t.zIndex),void 0!==t.alpha&&(e.alpha=t.alpha),void 0!==t.anchor&&e.setAnchorType(t.anchor.x,t.anchor.y),void 0!==t.offsetX&&e.setFormulaOffsetX(t.offsetX),void 0!==t.offsetY&&e.setFormulaOffsetY(t.offsetY),void 0!==t.sizeX&&e.setFormulaSizeX(t.sizeX),void 0!==t.sizeY&&e.setFormulaSizeY(t.sizeY),void 0!==t.enable&&(e.enable=t.enable);for(var i=t.children,s=0;s!==i.length;++s)e.add(Q.wtFactory(i[s]));return e},scissors:[],getScissorID:function(t){for(var e=v.scissors.length,i=0;i!==e;++i)if(t.equals(v.scissors[i]))return i;return v.scissors.push(t),e}}),g.prototype=Object.assign(Object.create(v.prototype),{constructor:g,setBlendMode:function(t,e){this._srcFactor=t,this._dstFactor=e},getMatCfg:function(){return{enable:this.enable,scissorID:this.scissorID,texture:this._atlas.texture,srcFactor:this._srcFactor,dstFactor:this._dstFactor}},setSprite:function(t,e){this.image=t,this.sprite=e,this._atlas=Halo.ResourceManager.getSimpleSprite(t,e)||Halo.ResourceManager.defaultSimpleSprite},getVertexCount:function(){return 4},getIndexCount:function(){return 6},encode:function(){var t=v.prototype.encode.call(this);t.image=this.image,t.sprite=this.sprite;var e=this.color.getHex();return 16777215!==e&&(t.color=e),t},updatePosition:function(t,e){var i=.5-.5*this.scale,s=this.size.x*i,r=this.size.y*i,a=this.dimension.min.x+s,n=this.dimension.min.y+r,o=this.dimension.max.x-s,h=this.dimension.max.y-r;t.setXYZ(e,a,h,0),t.setXYZ(e+1,o,h,0),t.setXYZ(e+2,o,n,0),t.setXYZ(e+3,a,n,0)},updateColor:function(t,e){var i=255*this.color.r,s=255*this.color.g,r=255*this.color.b,a=255*this.worldAlpha;t.setXYZW(e,i,s,r,a),t.setXYZW(e+1,i,s,r,a),t.setXYZW(e+2,i,s,r,a),t.setXYZW(e+3,i,s,r,a)},updateUV:function(t,e){this._atlas.updateUV(t,e)},updateIndex:function(t,e,i){t.array[e++]=i,t.array[e++]=i+2,t.array[e++]=i+1,t.array[e++]=i,t.array[e++]=i+3,t.array[e++]=i+2},render:function(t){var e=this.parent?this.parent.dimension:this.dimension;if(this.visible&&e.intersectsBox(this.dimension)){t.push(this);for(var i=0,s=this.children.length;i<s;i++)this.children[i].render(t)}}}),Object.assign(g,{decode:function(t,e){return e=e||new g(t.image,t.sprite),v.decode(t,e),void 0!==t.color&&e.color.setHex(t.color),e}}),y.prototype=Object.assign(Object.create(g.prototype),{constructor:y,onClick:function(t){this._onClick=t;try{this._onClickFunc=new Function("wt",t)}catch(t){alert(t)}},encode:function(){var t=g.prototype.encode.call(this);return this._onClick&&(t.onClick=this._onClick),t}}),Object.assign(y,{decode:function(t,e){return e=e||new y(t.image,t.sprite),g.decode(t,e),void 0!==t.onClick&&e.onClick(t.onClick),e}}),Object.assign(x.prototype,{updateUV:function(t,e){t.setXY(e,this.x1,this.y1),t.setXY(e+1,this.x2,this.y1),t.setXY(e+2,this.x2,this.y2),t.setXY(e+3,this.x1,this.y2)}});var K=function(){var t=document.createElement("canvas"),e=t.getContext("2d"),i={},s=0;t.width=2048,t.height=2048,e.textAlign="left",e.textBaseline="top";var r=1/t.width,a=1/t.height,n=new THREE.Texture(t);n.generateMipmaps=!1,n.minFilter=THREE.NearestFilter;var o={x:0,y:0,line_height:0},h=document.createElement("p"),c=function(t,i){h.style.font=i,document.body.appendChild(h);var s={width:e.measureText(t).width,height:parseInt(window.getComputedStyle(h).fontSize,10)};return document.body.removeChild(h),s},l=function(t,e,r){var a={id:++s,str:t,width:e,height:r,x:0,y:0};return i[s]=a,a},d=function(){for(var s in i){var r=i[s];o.x+r.width>t.width?(o.x=0,o.line_height=r.height,o.y+=o.line_height,o.y+r.height>t.height&&(o.line_height=0,o.y=0,console.error("Error: TextCanvas is too small!"))):o.line_height=Math.max(r.height,o.line_height),r.x=o.x,r.y=o.y,o.x+=r.width,e.clearRect(r.x,r.y,r.width,r.height),e.fillText(r.str,r.x,r.y,r.width)}n.needsUpdate=!0};return{getTexture:function(){return n},getInvW:function(){return r},getInvH:function(){return a},remove:function(t){for(var e=0;e!==t.length;++e)delete i[t[e].id]},addText:function(i,s,r,a,h){e.font=s,e.fillStyle="#"+a.getHexString();for(var u=i.split("\n"),p=[],f=0,m=0;m!==u.length;++m){var v=u[m],g=c(v,s);if(g.width>r)if(h){for(var f=0,y="",x=0;x!==v.length;++x){var E=v[x],b=e.measureText(E).width;f+b>r?(p.push(l(y,f,g.height)),f=b,y=E):(y+=E,f+=b)}p.push(l(y,f,g.height))}else p.push(l(v,r,g.height));else p.push(l(v,g.width,g.height))}for(var m=0,w=p.length;m!==w;++m){y=p[m];if(o.x+y.width>t.width){if(o.x=0,o.line_height=y.height,o.y+=o.line_height,o.y+y.height>t.height)return o.y=0,o.line_height=0,d(),p}else o.line_height=Math.max(y.height,o.line_height);y.x=o.x,y.y=o.y,o.x+=y.width}for(var m=0,w=p.length;m!==w;++m){y=p[m];e.clearRect(y.x,y.y,y.width,y.height),e.fillText(y.str,y.x,y.y,y.width)}return p.length>0&&(n.needsUpdate=!0),p}}}();E.prototype=Object.assign(Object.create(v.prototype),{constructor:E,getMatCfg:function(){return{enable:this.enable,scissorID:this.scissorID,texture:K.getTexture(),srcFactor:this._srcFactor,dstFactor:this._dstFactor}},getVertexCount:function(){return 4*this.lines.length},getIndexCount:function(){return 6*this.lines.length},updatePosition:function(t,e){for(var i,s,r,a,n=.5-.5*this.scale,o=this.size.x*n,h=this.size.y*n,c=this.line_gap*this.scale,l=this.dimension.min.x+o,d=this.dimension.max.x-o,u=this.dimension.max.y-h,p=0;p!=this.lines.length;++p){var f=this.lines[p],m=f.width*this.scale,v=f.height*this.scale;if(this.text_align===G)s=(i=l)+m;else if(2===this.text_align){var g=l+d;i=.5*(g-m),s=.5*(g+m)}else 3===this.text_align&&(i=d-m,s=d);r=(a=u-(v+c)*p)-v,t.setXYZ(e,i,a,0),t.setXYZ(e+1,s,a,0),t.setXYZ(e+2,s,r,0),t.setXYZ(e+3,i,r,0),e+=4}},updateColor:function(t,e){for(var i=0;i!=this.lines.length;++i){var s=255*this.worldAlpha;t.setXYZW(e,255,255,255,s),t.setXYZW(e+1,255,255,255,s),t.setXYZW(e+2,255,255,255,s),t.setXYZW(e+3,255,255,255,s),e+=4}},updateUV:function(t,e){for(var i=0;i!=this.lines.length;++i){var s=this.lines[i],r=65535*K.getInvW(),a=65535*K.getInvH(),n=s.x*r,o=65535-s.y*a,h=n+s.width*r,c=o-s.height*a;t.setXY(e,n,o),t.setXY(e+1,h,o),t.setXY(e+2,h,c),t.setXY(e+3,n,c),e+=4}},updateIndex:function(t,e,i){for(var s=0;s!=this.lines.length;++s)t.array[e++]=i,t.array[e++]=i+2,t.array[e++]=i+1,t.array[e++]=i,t.array[e++]=i+3,t.array[e++]=i+2,i+=4},refresh:function(){K.remove(this.lines),this.lines=K.addText(this.text,this.font,this.size.x,this.color,this.auto_break)},render:function(t){var e=this.parent?this.parent.dimension:this.dimension;if(this.visible&&e.intersectsBox(this.dimension)){t.push(this);for(var i=0,s=this.children.length;i<s;i++)this.children[i].render(t)}},encode:function(){var t=v.prototype.encode.call(this);t.text=this.text,"20px Arial"!==this.font&&(t.font=this.font);var e=this.color.getHex();return 0!==e&&(t.color=e),this.auto_break&&(t.auto_break=!0),this.text_align!==G&&(t.text_align=this.text_align),0!==this.line_gap&&(t.line_gap=this.line_gap),t},relayout:function(t){v.prototype.relayout.call(this,t),this.max_width!==this.size.x&&(this.max_width=this.size.x,this.refresh())}}),Object.assign(E,{decode:function(t,e){return e=e||new E(t.text),v.decode(t,e),void 0!==t.font&&(e.font=t.font),void 0!==t.color&&e.color.setHex(t.color),e.auto_break=!0===t.auto_break,void 0!==t.text_align&&(e.text_align=t.text_align),void 0!==t.line_gap&&(e.line_gap=t.line_gap),e}}),b.prototype=Object.assign(Object.create(g.prototype),{constructor:b,getVertexCount:function(){return 16},getIndexCount:function(){return 54},updatePosition:function(t,e){var i=this.dimension.min.x,s=this.dimension.min.y,r=this.dimension.max.x,a=this.dimension.max.y,n=i+this.core.min.x*this.boarder.x,o=r-(1-this.core.max.x)*this.boarder.x,h=s+this.core.min.y*this.boarder.y,c=a-(1-this.core.max.y)*this.boarder.y;t.setXYZ(e++,i,s,0),t.setXYZ(e++,n,s,0),t.setXYZ(e++,o,s,0),t.setXYZ(e++,r,s,0),t.setXYZ(e++,i,h,0),t.setXYZ(e++,n,h,0),t.setXYZ(e++,o,h,0),t.setXYZ(e++,r,h,0),t.setXYZ(e++,i,c,0),t.setXYZ(e++,n,c,0),t.setXYZ(e++,o,c,0),t.setXYZ(e++,r,c,0),t.setXYZ(e++,i,a,0),t.setXYZ(e++,n,a,0),t.setXYZ(e++,o,a,0),t.setXYZ(e++,r,a,0)},updateColor:function(t,e){for(var i=255*this.color.r,s=255*this.color.g,r=255*this.color.b,a=255*this.worldAlpha,n=0;16!==n;++n)t.setXYZW(e+n,i,s,r,a)},updateUV:function(t,e){var i=this._atlas.x1,s=this._atlas.x2,r=this._atlas.y1,a=this._atlas.y2,n=s-i,o=r-a,h=i+this.core.min.x*n,c=i+this.core.max.x*n,l=a+this.core.min.y*o,d=a+this.core.max.y*o;t.setXY(e++,i,a),t.setXY(e++,h,a),t.setXY(e++,c,a),t.setXY(e++,s,a),t.setXY(e++,i,l),t.setXY(e++,h,l),t.setXY(e++,c,l),t.setXY(e++,s,l),t.setXY(e++,i,d),t.setXY(e++,h,d),t.setXY(e++,c,d),t.setXY(e++,s,d),t.setXY(e++,i,r),t.setXY(e++,h,r),t.setXY(e++,c,r),t.setXY(e++,s,r)},updateIndex:function(t,e,i){for(var s=0;3!=s;++s)for(var r=0;3!=r;++r){var a=r+4*s+i,n=a+1,o=a+4,h=a+5;t.array[e++]=a,t.array[e++]=n,t.array[e++]=o,t.array[e++]=n,t.array[e++]=h,t.array[e++]=o}},encode:function(){var t=g.prototype.encode.call(this);return this.core.equals(b.DEFAULT_CORE)||(t.core={x1:this.core.min.x,y1:this.core.min.y,x2:this.core.max.x,y2:this.core.max.y}),this.boarder.equals(b.DEFAULT_BOARDER)||(t.boarder={x:this.boarder.x,y:this.boarder.y}),t}}),Object.assign(b,{decode:function(t,e){return e=e||new b(t.image,t.sprite),g.decode(t,e),void 0!==t.core&&(e.core.min.set(t.core.x1,t.core.y1),e.core.max.set(t.core.x2,t.core.yy)),void 0!==t.boarder&&e.boarder.set(t.boarder.x,t.boarder.y),e},DEFAULT_CORE:new THREE.Box2(new THREE.Vector2(.5,.5),new THREE.Vector2(.5,.5)),DEFAULT_BOARDER:new THREE.Vector2(0,0)}),w.prototype=Object.assign(Object.create(g.prototype),{constructor:w,updatePosition:function(t,e){var i,s,r,a;this.horizontal?(this.reversed?i=(r=this.dimension.max.x)-this.size.x*this.progress:r=(i=this.dimension.min.x)+this.size.x*this.progress,s=this.dimension.min.y,a=this.dimension.max.y):(this.reversed?s=(a=this.dimension.max.y)-this.size.y*this.progress:a=(s=this.dimension.min.y)+this.size.y*this.progress,i=this.dimension.min.x,r=this.dimension.max.x),t.setXYZ(e++,i,a,0),t.setXYZ(e++,r,a,0),t.setXYZ(e++,r,s,0),t.setXYZ(e,i,s,0)},encode:function(){var t=g.prototype.encode.call(this);return this.horizontal||(t.horizontal=!1),this.reversed&&(t.reversed=!0),t}}),Object.assign(w,{decode:function(t,e){return e=e||new w(t.image,t.sprite),g.decode(t,e),void 0!==t.horizontal&&(e.horizontal=t.horizontal),void 0!==t.reversed&&(e.reversed=t.reversed),e}}),_.prototype=Object.assign(Object.create(v.prototype),{constructor:_,remove:function(t){v.prototype.remove.call(this,t),this._dirty=!0},relayout:function(t){if(this.visible){if(this.parent?(this.worldAlpha=this.alpha*this.parent.worldAlpha,this.z=this.parent.z+this.zIndex):this.worldAlpha=this.alpha,t=t||this._dirty){this.doRelayout();var e=v.getScissorID(this.dimension);this.enableScissor(e),this._length=0;var i=this.size.x,s=this.size.y;if(this.horizontal)for(var r=0,a=this.children.length;r<a;r++){var n=(h=this.children[r]).formulaOffsetXFunc(i,s),o=h.formulaSizeXFunc(i,s);this._length=Math.max(this._length,n+o)}else for(var r=0,a=this.children.length;r<a;r++){var h=this.children[r],c=h.formulaOffsetYFunc(i,s),l=h.formulaSizeYFunc(i,s);this._length=Math.max(this._length,c+l)}}if(this.horizontal){var d=this.size.x;this.size.x=Math.max(d,this._length),this.dimension.min.x+=this._position,this.dimension.max.x+=this._position;for(var r=0,a=this.children.length;r<a;r++)this.children[r].relayout(this._moved);this.size.x=d,this.dimension.min.x-=this._position,this.dimension.max.x-=this._position}else{var u=this.size.y;this.size.y=Math.max(u,this._length),this.dimension.min.y+=this._position,this.dimension.max.y+=this._position;for(var r=0,a=this.children.length;r<a;r++)this.children[r].relayout(this._moved);this.size.y=u,this.dimension.min.y-=this._position,this.dimension.max.y-=this._position}this._moved=!1}},encode:function(){var t=v.prototype.encode.call(this);return this.horizontal||(t.horizontal=!1),t}}),Object.assign(_,{decode:function(t,e){return e=e||new _(t.image,t.sprite),v.decode(t,e),void 0!==t.horizontal&&(e.horizontal=t.horizontal),e}}),T.prototype=Object.assign(Object.create(v.prototype),{constructor:T,add:function(t){if(t===this)return console.error("Halo.Widget.add: widget can't be added as a child of itself.",t),this;t&&t.isWidget?(null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),this.refresh(this.children.length-1)):console.error("Halo.Widget.add: widget not an instance of Halo.Object2D.",t)},remove:function(t){var e=this.children.indexOf(t);-1!==e&&(t.parent=null,this.children.splice(e,1),this.refresh(e))},refresh:function(t){void 0===t&&(t=0);for(var e=this.children.length;t<e;){var i,s,r=this.children[t];this.horizontal?(i=t%this.nColumn,s=Math.floor(t/this.nColumn)):(i=Math.floor(t/this.nColumn),s=t%this.nColumn),i*=this.gridWidth+this.gapX,s*=this.gridHeight+this.gapY;var a=this.reverseX?3:G,n=this.reverseY?6:N;r.setAnchorType(a,n),r.setOffset(i,s),++t}var o=Math.ceil(e/this.nColumn);this.horizontal?this.setSize(this.nColumn*(this.gridWidth+this.gapX)-this.gapX,o*(this.gridHeight+this.gapY)-this.gapY):this.setSize(o*(this.gridWidth+this.gapX)-this.gapX,this.nColumn*(this.gridHeight+this.gapY)-this.gapY)},encode:function(){var t=v.prototype.encode.call(this);return this.horizontal||(t.horizontal=!1),this.reverseX&&(t.reverseX=!0),this.reverseY&&(t.reverseY=!0),4!==this.nColumn&&(t.nColumn=this.nColumn),100!==this.gridHeight&&(t.gridHeight=this.gridHeight),100!==this.gridWidth&&(t.gridWidth=this.gridWidth),0!==this.gapX&&(t.gapX=this.gapX),0!==this.gapY&&(t.gapY=this.gapY),t}}),Object.assign(T,{decode:function(t,e){return e=e||new T,v.decode(t,e),void 0!==t.horizontal&&(e.horizontal=t.horizontal),void 0!==t.reverseX&&(e.reverseX=t.reverseX),void 0!==t.reverseY&&(e.reverseY=t.reverseY),void 0!==t.nColumn&&(e.nColumn=t.nColumn),void 0!==t.gridWidth&&(e.gridWidth=t.gridWidth),void 0!==t.gridHeight&&(e.gridHeight=t.gridHeight),void 0!==t.gapX&&(e.gapX=t.gapX),void 0!==t.gapY&&(e.gapY=t.gapY),e.refresh(),e}}),R.prototype=Object.assign(Object.create(b.prototype),{constructor:R,close:function(){this.visible=!1;try{this._onCloseFunc&&this._onCloseFunc(this)}catch(t){console.log(t)}},onClose:function(t){this._onClose=t;try{this._onCloseFunc=new Function("wt",t)}catch(t){alert(t)}},encode:function(){var t=b.prototype.encode.call(this);return this._onClose&&(t.onClose=this._onClose),t}}),Object.assign(R,{decode:function(t,e){return e=e||new R(t.image,t.sprite),b.decode(t,e),void 0!==t.onClose&&e.onClose(t.onClose),e}}),Object.assign(M.prototype,{set:function(t,e,i,s,r,a){return this.a=t,this.b=e,this.c=i,this.d=s,this.tx=r,this.ty=a,this},apply:function(t,e){e=e||new THREE.Vector2;var i=t.x,s=t.y;return e.x=this.a*i+this.c*s+this.tx,e.y=this.b*i+this.d*s+this.ty,e},applyInverse:function(t,e){e=e||new THREE.Vector2;var i=1/(this.a*this.d+this.c*-this.b),s=t.x,r=t.y;return e.x=this.d*i*s+-this.c*i*r+(this.ty*this.c-this.tx*this.d)*i,e.y=this.a*i*r+-this.b*i*s+(-this.ty*this.a+this.tx*this.b)*i,e},translate:function(t,e){return this.tx+=t,this.ty+=e,this},scale:function(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this},rotate:function(t){var e=Math.cos(t),i=Math.sin(t),s=this.a,r=this.c,a=this.tx;return this.a=s*e-this.b*i,this.b=s*i+this.b*e,this.c=r*e-this.d*i,this.d=r*i+this.d*e,this.tx=a*e-this.ty*i,this.ty=a*i+this.ty*e,this},append:function(t){var e=this.a,i=this.b,s=this.c,r=this.d;return this.a=t.a*e+t.b*s,this.b=t.a*i+t.b*r,this.c=t.c*e+t.d*s,this.d=t.c*i+t.d*r,this.tx=t.tx*e+t.ty*s+this.tx,this.ty=t.tx*i+t.ty*r+this.ty,this},setTransform:function(t,e,i,s,r,a,n,o,h){var c=Math.sin(n),l=Math.cos(n),d=Math.cos(h),u=Math.sin(h),p=-Math.sin(o),f=Math.cos(o),m=l*r,v=c*r,g=-c*a,y=l*a;return this.a=d*m+u*g,this.b=d*v+u*y,this.c=p*m+f*g,this.d=p*v+f*y,this.tx=t+(i*m+s*g),this.ty=e+(i*v+s*y),this},prepend:function(t){var e=this.tx;if(1!==t.a||0!==t.b||0!==t.c||1!==t.d){var i=this.a,s=this.c;this.a=i*t.a+this.b*t.c,this.b=i*t.b+this.b*t.d,this.c=s*t.a+this.d*t.c,this.d=s*t.b+this.d*t.d}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this},decompose:function(t){var e=this.a,i=this.b,s=this.c,r=this.d,a=-Math.atan2(-s,r),n=Math.atan2(i,e);return Math.abs(a+n)<1e-5?(t.rotation=n,e<0&&r>=0&&(t.rotation+=t.rotation<=0?Math.PI:-Math.PI),t.skew.x=t.skew.y=0):(t.skew.x=a,t.skew.y=n),t.scale.x=Math.sqrt(e*e+i*i),t.scale.y=Math.sqrt(s*s+r*r),t.position.x=this.tx,t.position.y=this.ty,t},invert:function(){var t=this.a,e=this.b,i=this.c,s=this.d,r=this.tx,a=t*s-e*i;return this.a=s/a,this.b=-e/a,this.c=-i/a,this.d=t/a,this.tx=(i*this.ty-s*r)/a,this.ty=-(t*this.ty-e*r)/a,this},identity:function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},clone:function(){var t=new M;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t},copy:function(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this}}),Object.assign(S.prototype,{updateSkew:function(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x)},updateLocalTransform:function(){var t=this.localTransform;t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d)},updateTransform:function(t){var e=this.localTransform;e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d);var i=t.worldTransform,s=this.worldTransform;s.a=e.a*i.a+e.b*i.c,s.b=e.a*i.b+e.b*i.d,s.c=e.c*i.a+e.d*i.c,s.d=e.c*i.b+e.d*i.d,s.tx=e.tx*i.a+e.ty*i.c+i.tx,s.ty=e.tx*i.b+e.ty*i.d+i.ty,this._worldID++},setFromMatrix:function(t){t.decompose(this)}}),Object.defineProperty(S.prototype,"rotation",{get:function(){return this._rotation},set:function(t){this._rotation=t,this.updateSkew()},enumerable:!0,configurable:!0}),Object.assign(H.prototype,{isObject2D:!0,updateTransform:function(){this.parent?(this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha):(this.transform.updateLocalTransform(),this.worldAlpha=this.alpha);for(var t=0,e=this.children.length;t<e;++t){var i=this.children[t];i.visible&&i.updateTransform()}},setTransform:function(t,e,i,s,r,a,n,o,h){return this.transform.position.x=t,this.transform.position.y=e,this.transform.scale.x=i||1,this.transform.scale.y=s||1,this.transform.rotation=r,this.transform.skew.x=a,this.transform.skew.y=n,this.transform.pivot.x=o,this.transform.pivot.y=h,this},add:function(t){if(t===this)return console.error("Halo.Object2D.add: object can't be added as a child of itself.",t),this;t&&t.isObject2D?(null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t)):console.error("Halo.Object2D.add: object not an instance of Halo.Object2D.",t)},remove:function(t){var e=this.children.indexOf(t);-1!==e&&(t.parent=null,this.children.splice(e,1))},traverse:function(t){if(this.visible){t(this);for(var e=0,i=this.children.length;e<i;e++)this.children[e].traverse(t)}},render:function(t){if(this.visible)for(var e=0,i=this.children.length;e<i;e++)this.children[e].render(t)}}),A.prototype=Object.assign(Object.create(v.prototype),{constructor:A,relayout:function(t){var e=this.visible&&(t||this._dirty);v.prototype.relayout.call(this,t),e&&(this.center.copy(this.dimension.min),this.center.add(this.dimension.max),this.center.multiplyScalar(.5),this.obj2d.transform.position.copy(this.center))}}),Object.assign(A,{decode:function(t,e){return e=e||new A,v.decode(t,e),e}});var Q=function(){var t=null,e={},i={},s=null,r=null,a=null,n={},o=null,h={Widget:v,WtImage:g,WtButton:y,WtText:E,WtPanel:b,WtProgressBar:w,WtScrollView:_,WtGridView:T,WtDialog:R,WtObject2D:A},c=function(t){if(t.simple_atlas)for(var e=0;e!==t.simple_atlas.length;++e){var i=t.simple_atlas[e];it.parseSimpleAtlas(i.cfg,i.img)}},l=function(t){if(o&&t.atlas)for(var e=0;e!==t.atlas.length;++e){var i=t.atlas[e],s=it.getObj("img",i.img),r=it.getObj("cfg",i.cfg);o.parseTextureAtlasData(r,s.image)}},d=function(t){if(o&&t.dragonbones)for(var e=0;e!==t.dragonbones.length;++e){var i=it.getObj("cfg",t.dragonbones[e]);o.parseDragonBonesData(i)}},u=function(t){if(t.funcs)for(var e=0;e!==t.funcs.length;++e){var i=t.funcs[e],s=it.getObj("cfg",i);for(var r in s){var a=s[r],o=a.argv,h=a.body;switch(o?o.length:0){case 0:n[r]=new Function(h);break;case 1:n[r]=new Function(o[0],h);break;case 2:n[r]=new Function(o[0],o[1],h);break;case 3:n[r]=new Function(o[0],o[1],o[2],h);break;case 4:n[r]=new Function(o[0],o[1],o[2],o[3],h)}}}},p=function(t){var s=it.loadData({path:"",name:"effect.json",raw:null}),r=it.loadData({path:"",name:"widget.json",raw:null});Promise.all([s,r]).then(function(s){var r=JSON.parse(s[0].r.raw);for(var a in r){for(var n=r[a],o=[],h=0,c=n.length;h!=c;++h)o.push(new m(n[h]));e[a]=o}i=JSON.parse(s[1].r.raw),t()})},f=function(t,e){var i=t.resources?t.resources.slice(0):[];if(t.simple_atlas&&t.simple_atlas.length>0)for(s=0;s!==t.simple_atlas.length;++s)i.push({path:"cfg",name:t.simple_atlas[s].cfg}),i.push({path:"img",name:t.simple_atlas[s].img});if(t.atlas&&t.atlas.length>0)for(s=0;s!==t.atlas.length;++s)i.push({path:"cfg",name:t.atlas[s].cfg}),i.push({path:"img",name:t.atlas[s].img});if(t.dragonbones&&t.dragonbones.length>0)for(s=0;s!==t.dragonbones.length;++s)i.push({path:"cfg",name:t.dragonbones[s]});if(t.funcs&&t.funcs.length>0)for(var s=0;s!==t.funcs.length;++s)i.push({path:"cfg",name:t.funcs[s]});i.length>0?it.loadList(i,function(t,i){e(i)}):e(0)};return{updateDragonBones:function(t){o&&o.tick(t)},init:function(s,r){try{o=dragonBones.XFactory.factory}catch(t){}s&&(t=s,e={},i={},n={},p(function(){f(t,function(e){0===e&&(c(t),l(t),d(t),u(t)),r&&r(e)})}))},initProject:function(s,r,a){try{o=dragonBones.XFactory.factory}catch(t){}t=s,e={},i={},n={};for(var h in a){for(var p=a[h],f=[],v=0,g=p.length;v!=g;++v)f.push(new m(p[v]));e[h]=f}i=r,c(t),l(t),d(t),u(t)},loadBatch:function(e,i){var s=e?t.batches[e]:t;s?f(s,function(t){0===t&&(c(s),l(s),d(s),u(s)),i&&i(t)}):i&&i(0)},loadAllBatch:function(e){var i={simple_atlas:[],atlas:[],dragonbones:[],funcs:[]};for(var s in t.batches){var r=t.batches[s];if(r.simple_atlas&&r.simple_atlas.length>0)for(a=0;a!==r.simple_atlas.length;++a)i.simple_atlas.push({cfg:r.simple_atlas[a].cfg,img:r.simple_atlas[a].img});if(r.atlas&&r.atlas.length>0)for(a=0;a!==r.atlas.length;++a)i.atlas.push({cfg:r.simple_atlas[a].cfg,img:r.simple_atlas[a].img});if(r.dragonbones&&r.dragonbones.length>0)for(a=0;a!==r.dragonbones.length;++a)i.dragonbones.push(r.dragonbones[a]);if(r.funcs&&r.funcs.length>0)for(var a=0;a!==r.funcs.length;++a)i.funcs.push(r.funcs[a])}f(i,function(t){0===t&&(c(i),l(i),d(i),u(i),e&&e())})},play:function(e){if((s=it.getObj("scn",e||t.entry_scene))?s.camera&&(r=s.camera):s=new Halo.HaloScene,!r){var i=1;if(a){var n=a.getSize();n.width>0&&n.height>0&&(i=n.width/n.height)}(r=new THREE.PerspectiveCamera(50,i,.1,1e4)).position.set(20,10,20),r.lookAt(new THREE.Vector3(0,0,0))}return s},onResizeWindow:function(t,e){a&&a.setSize(t,e),s&&s.onResizeWindow(t,e),r&&(r.aspect=t/e,r.updateProjectionMatrix())},renderer:function(){return a},camera:function(){return r},scene:function(){return s},update:function(t){a.clear(),s&&(s.update(t),r&&a.render(s,r))},start:function(e){(a=new THREE.WebGLRenderer({alpha:t.alpha,antialias:t.antialias,preserveDrawingBuffer:t.preserveDrawingBuffer})).autoClear=!1,a.autoUpdateScene=!1,a.shadowMap.enabled=!0,a.shadowMap.type=t.shadowMapType||THREE.PCFShadowMap,a.setPixelRatio(window.devicePixelRatio),a.setClearColor(t.clear_color||11184810,t.alpha?0:1),t.alpha&&(a.domElement.style.background="transparent"),e.appendChild(a.domElement)},get:function(){return t||(t={}),t},getEffect:function(t){return e[t]},effects:function(){return e},getFunc:function(t){return n[t]},funcs:function(){return n},getWidget:function(t){return i[t]},widgets:function(){return i},createWidget:function(t){var e=i[t];return void 0===e?null:h[e.class].decode(e)},wtClass:function(t){return h[t]},wtFactory:function(t){return h[t.class].decode(t)}}}(),$={uv_animation:["varying vec2 vUV;","void main() {","vUV = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","}"].join("\n"),halo:["varying vec2 vUV;","varying vec3 vNormal;","uniform float uDistance;","void main() {","vUV = uv;","vNormal = normalize( normalMatrix * normal );","gl_Position = projectionMatrix * modelViewMatrix * vec4( position + normal * uDistance, 1.0 );","}"].join("\n")},tt={uv_animation:["varying vec2 vUV;","uniform sampler2D tSprite;","uniform vec2 uSpeed;","uniform vec2 uRepeat;","uniform float uTimer;","uniform float opacity;","void main() {","vec2 uv = vUV * uRepeat + uTimer * uSpeed;","vec4 color = texture2D(tSprite, uv);","gl_FragColor = vec4(color.rgb, color.a * opacity);","}"].join("\n"),uv_frame:["varying vec2 vUV;","uniform sampler2D tSprite;","uniform float uFrames;","uniform float uCols;","uniform float uFPS;","uniform float uTimer;","uniform float opacity;","void main() {","float nRows = ceil(uFrames/uCols);","vec2 uvUnit = vec2(1.0/uCols, 1.0/nRows);","float nFrame = ceil(uTimer * uFPS);","vec2 uvIndex = vec2(mod(nFrame, uCols), floor(nFrame/uCols));","vec2 uv = (vec2(vUV.x, 1.0-vUV.y) + uvIndex) * uvUnit;","vec4 color = texture2D(tSprite, vec2(uv.x, 1.0-uv.y));","gl_FragColor = vec4(color.rgb, color.a * opacity);","}"].join("\n"),halo:["varying vec2 vUV;","varying vec3 vNormal;","uniform sampler2D tSprite;","uniform float uConst;","uniform float uPower;","void main() {","float intensity = pow( uConst - dot(vNormal, vec3(0.0, 0.0, 1.0)), uPower );","vec4 diffuse = texture2D(tSprite, vUV);","gl_FragColor = vec4(diffuse.xyz * intensity, 1.0);","}"].join("\n")};(O.prototype=Object.create(THREE.ShaderMaterial.prototype)).constructor=O,O.prototype.isUVAnimMaterial=!0,(D.prototype=Object.create(THREE.ShaderMaterial.prototype)).constructor=D,D.prototype.isUVFrameMaterial=!0,(F.prototype=Object.create(THREE.ShaderMaterial.prototype)).constructor=F,F.prototype.isHaloMaterial=!0,C.prototype=Object.assign(Object.create(THREE.BufferGeometry.prototype),{constructor:C,getMatCfg:function(){return{shaderIdx:this.shaderIdx,texture:this.sprites[0].texture,srcFactor:this.blend.src,dstFactor:this.blend.dst}},onUpdateBegin:function(){},onParticleEmission:function(t){this.template.random?t.frameIdx=k.randInt(0,this.sprites.length):t.frameIdx=0,this.sprites.length>t.frameIdx&&this.sprites[t.frameIdx].updateUV(this.attrUV,4*t.index)},onParticleUpdate:function(t){var e=this.sprites.length;if(e>0&&!this.template.random){var i=Math.floor(t.timer/this.template.interval);this.template.loop?i%=e:i>=e&&(i=e-1),t.frameIdx!==i&&(t.frameIdx=i,this.sprites[t.frameIdx].updateUV(this.attrUV,4*t.index))}var s=this.attrPosition.array,r=12*t.index;t.position.toArray(s,r),t.position.toArray(s,r+3),t.position.toArray(s,r+6),t.position.toArray(s,r+9),(s=this.attrRotation.array)[r=4*t.index]=s[r+1]=s[r+2]=s[r+3]=t.rotation,s=this.attrColor.array,r=4*t.index;var a=255*t.color.r,n=255*t.color.g,o=255*t.color.b,h=255*t.alpha;this.attrColor.setXYZW(r,a,n,o,h),this.attrColor.setXYZW(r+1,a,n,o,h),this.attrColor.setXYZW(r+2,a,n,o,h),this.attrColor.setXYZW(r+3,a,n,o,h),(s=this.attrScale.array)[(r=8*t.index)+0]=-t.scale.x,s[r+2]=+t.scale.x,s[r+4]=+t.scale.x,s[r+6]=-t.scale.x,s[r+1]=+t.scale.y,s[r+3]=+t.scale.y,s[r+5]=-t.scale.y,s[r+7]=-t.scale.y},onParticleDeath:function(t){var e=this.attrScale.array,i=8*t.index;e[i]=e[i+1]=e[i+2]=e[i+3]=e[i+4]=e[i+5]=e[i+6]=e[i+7]=0},onUpdateEnd:function(){this.attrPosition.needsUpdate=!0,this.attrRotation.needsUpdate=!0,this.attrScale.needsUpdate=!0,this.attrColor.needsUpdate=!0,this.attrUV.needsUpdate=!0}}),z.prototype=Object.assign(Object.create(THREE.BufferGeometry.prototype),{constructor:z,getMatCfg:function(){return{shaderIdx:this.shaderIdx,texture:this.sprites[0].texture,srcFactor:this.blend.src,dstFactor:this.blend.dst}},onUpdateBegin:function(){},onParticleEmission:function(t){this.template.random?t.frameIdx=k.randInt(0,this.sprites.length):t.frameIdx=0,this.sprites.length>t.frameIdx&&this.sprites[t.frameIdx].updateUV(this.attrUV,4*t.index)},onParticleUpdate:function(t){var e=this.sprites.length;if(e>0&&!this.template.random){var i=Math.floor(t.timer/this.template.interval);this.template.loop?i%=e:i>=e&&(i=e-1),t.frameIdx!==i&&(t.frameIdx=i,this.sprites[t.frameIdx].updateUV(this.attrUV,4*t.index))}var s=this.attrPosition.array,r=12*t.index;t.position.toArray(s,r),t.position.toArray(s,r+3),t.position.toArray(s,r+6),t.position.toArray(s,r+9),s=this.attrVelocity.array,r=12*t.index,t.velocity.toArray(s,r),t.velocity.toArray(s,r+3),t.velocity.toArray(s,r+6),t.velocity.toArray(s,r+9),s=this.attrColor.array,r=4*t.index;var a=255*t.color.r,n=255*t.color.g,o=255*t.color.b,h=255*t.alpha;this.attrColor.setXYZW(r,a,n,o,h),this.attrColor.setXYZW(r+1,a,n,o,h),this.attrColor.setXYZW(r+2,a,n,o,h),this.attrColor.setXYZW(r+3,a,n,o,h),(s=this.attrScale.array)[(r=8*t.index)+0]=-t.scale.x,s[r+2]=+t.scale.x,s[r+4]=+t.scale.x,s[r+6]=-t.scale.x,s[r+1]=+t.scale.y,s[r+3]=+t.scale.y,s[r+5]=-t.scale.y,s[r+7]=-t.scale.y},onParticleDeath:function(t){var e=this.attrScale.array,i=8*t.index;e[i]=e[i+1]=e[i+2]=e[i+3]=e[i+4]=e[i+5]=e[i+6]=e[i+7]=0},onUpdateEnd:function(){this.attrPosition.needsUpdate=!0,this.attrVelocity.needsUpdate=!0,this.attrScale.needsUpdate=!0,this.attrColor.needsUpdate=!0,this.attrUV.needsUpdate=!0}}),X.prototype=Object.assign(Object.create(THREE.Mesh.prototype),{constructor:X,play:function(){for(var t=0,e=this.template.renderer.count;t!==e;++t)this.particles.push(new j(t));this.mark=0,this.emitting=!0,this.fractionEmitNum=0,this.timer=0},stop:function(){this.emitting=!1},update:function(t){if(!this.emitting&&0===this.mark)return!0;this.geometry.onUpdateBegin();for(var e=0;e<this.mark;)if((h=this.particles[e]).timer+=t,h.timer>h.life){h.setActive(!1);var i=this.particles[--this.mark];this.particles[e]=i,this.particles[this.mark]=h,this.geometry.onParticleDeath(h)}else{var s=h.timer;this.template.period>0&&(s=THREE.Math.euclideanModulo(s,this.template.peroid)),h.ratio=s/h.life,this.template.affect(h,t),!this.emitting&&this.template.doFadeout(h,t)&&(h.life=0),++e}if(this.emitting&&this.template.isEmissionOver(this.timer)&&(this.emitting=!1),this.emitting){var r=this.template.getEmitNum(this.timer,t,this.template.renderer.count-this.mark,this.fractionEmitNum),a=r.num;this.fractionEmitNum=r.fraction,this.timer+=t;for(var n=0;n!==a;++n){h=this.particles[this.mark++];this.template.init(h),this.template.global&&h.position.applyMatrix4(this.matrixWorld),this.geometry.onParticleEmission(h)}}for(var o=0;o<this.mark;++o){var h=this.particles[o];this.geometry.onParticleUpdate(h)}return this.geometry.onUpdateEnd(),!1},setTarget:function(t){}}),Object.assign(X,{shaders:["local","global","z_up_local","z_up_global","arrow_local","arrow_global"],VERTEX_SHADERS:{local:["attribute float rotation;","attribute vec4 color;","attribute vec2 scale;","varying vec4 vColor;","varying vec2 vUV;","void main() {","vColor = color;","vUV = uv;","vec4 viewPos = modelViewMatrix * vec4(position, 1.0);","float cosr = cos(rotation);","float sinr = sin(rotation);","float x = scale.x * cosr + scale.y * sinr;","float y = scale.y * cosr - scale.x * sinr;","viewPos.x = viewPos.x + x * 0.5;","viewPos.y = viewPos.y + y * 0.5;","gl_Position = projectionMatrix * viewPos;","}"].join("\n"),global:["attribute float rotation;","attribute vec4 color;","attribute vec2 scale;","varying vec4 vColor;","varying vec2 vUV;","void main() {","vColor = color;","vUV = uv;","vec4 viewPos = viewMatrix * vec4(position, 1.0);","float cosr = cos(rotation);","float sinr = sin(rotation);","float x = scale.x * cosr + scale.y * sinr;","float y = scale.y * cosr - scale.x * sinr;","viewPos.x = viewPos.x + x * 0.5;","viewPos.y = viewPos.y + y * 0.5;","gl_Position = projectionMatrix * viewPos;","}"].join("\n"),z_up_local:["attribute float rotation;","attribute vec4 color;","attribute vec2 scale;","varying vec4 vColor;","varying vec2 vUV;","void main() {","vColor = color;","vUV = uv;","float cosr = cos(rotation);","float sinr = sin(rotation);","float x = scale.x * cosr + scale.y * sinr;","float y = scale.y * cosr - scale.x * sinr;","vec3 pos = position + vec3(-x*0.5, 0.0, y*0.5);","gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1.0);","}"].join("\n"),z_up_global:["attribute float rotation;","attribute vec4 color;","attribute vec2 scale;","varying vec4 vColor;","varying vec2 vUV;","void main() {","vColor = color;","vUV = uv;","float cosr = cos(rotation);","float sinr = sin(rotation);","float x = scale.x * cosr + scale.y * sinr;","float y = scale.y * cosr - scale.x * sinr;","vec3 pos = position + vec3(-x*0.5, 0.0, y*0.5);","gl_Position = projectionMatrix * viewMatrix * vec4(pos, 1.0);","}"].join("\n"),arrow_local:["attribute vec3 velocity;","attribute vec4 color;","attribute vec2 scale;","varying vec4 vColor;","varying vec2 vUV;","void main() {","vColor = color;","vUV = uv;","vec4 viewPos = modelViewMatrix * vec4(position, 1.0);","vec4 viewVel = modelViewMatrix * vec4(velocity, 1.0);","vec4 viewOri = modelViewMatrix * vec4(0.0, 0.0, 0.0, 1.0);","vec3 yDir = normalize(viewVel.xyz - viewOri.xyz);","vec3 xDir = cross(yDir, vec3(0, 0, 1));","viewPos.xyz = viewPos.xyz + scale.x * 0.5 * xDir + scale.y * 0.5 * yDir;","gl_Position = projectionMatrix * viewPos;","}"].join("\n"),arrow_global:["attribute vec3 velocity;","attribute vec4 color;","attribute vec2 scale;","varying vec4 vColor;","varying vec2 vUV;","void main() {","vColor = color;","vUV = uv;","vec4 viewPos = viewMatrix * vec4(position, 1.0);","vec4 viewVel = viewMatrix * vec4(velocity, 1.0);","vec4 viewOri = viewMatrix * vec4(0.0, 0.0, 0.0, 1.0);","vec3 yDir = normalize(viewVel.xyz - viewOri.xyz);","vec3 xDir = cross(yDir, vec3(0, 0, 1));","viewPos.xyz = viewPos.xyz + scale.x * 0.5 * xDir + scale.y * 0.5 * yDir;","gl_Position = projectionMatrix * viewPos;","}"].join("\n")},FRAGMENT:["varying vec4 vColor;","varying vec2 vUV;","uniform sampler2D tSprite;","void main() {","vec4 tex = texture2D(tSprite, vUV);","gl_FragColor = tex * vColor;","}"].join("\n"),RENDERERS:{billboard:C,bb_arrow:z},BLENDS:{add:{src:THREE.SrcAlphaFactor,dst:THREE.OneFactor},blend:{src:THREE.SrcAlphaFactor,dst:THREE.OneMinusSrcAlphaFactor},dark:{src:THREE.DstColorFactor,dst:THREE.OneMinusSrcAlphaFactor},light:{src:THREE.SrcColorFactor,dst:THREE.OneFactor}},materials:{},getMaterial:function(t){var e=(t.texture.id<<16)+(t.shaderIdx<<8)+(t.srcFactor<<4)+t.dstFactor-3400,i=X.materials[e];if(void 0===i){var s=X.shaders[t.shaderIdx];(i=new THREE.ShaderMaterial({transparent:!0,depthWrite:!1,side:THREE.DoubleSide,blending:THREE.CustomBlending,blendEquation:THREE.AddEquation,blendSrc:t.srcFactor,blendDst:t.dstFactor,vertexShader:X.VERTEX_SHADERS[s],fragmentShader:X.FRAGMENT,uniforms:{tSprite:{value:t.texture}}})).needsUpdate=!0,X.materials[e]=i}return i}}),U.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:U,play:function(){this.active=!0,this.timer=0},stop:function(){for(var t=0,e=this.children.length;t!==e;++t)this.children[t].stop()},update:function(t){if(this.active){for(var e=this.children.length,i=0,s=this.children.length;i!==s;++i){var r=this.children[i],a=r.template.delay;this.timer<=a&&a<this.timer+t&&(r.visible=!0,r.play()),this.timer>=a&&r.update(t)&&(r.visible=!1,e--)}0===e&&this.maxDelay<this.timer+t&&(this.active=!1),this.timer+=t}},setTarget:function(t){},encode:function(){var t={type:this.type,name:this.name,matrix:this.matrix.toArray()};return t.deps=this.getDeps(),t}}),Object.assign(U,{decode:function(t){var e=new U(t.name);return e.matrix.fromArray(t.matrix),e.matrix.decompose(e.position,e.quaternion,e.scale),e.play(),e}}),I.prototype=Object.assign(Object.create(THREE.Scene.prototype),{constructor:I,getWidgetRoot:function(){return this._widgetRoot},getSpriteRoot:function(){return this._spriteRoot},update:function(t){THREE.Scene.prototype.update.call(this,t),Q.updateDragonBones(t),this._spriteRoot.updateTransform(),this._widgetRoot.relayout(),this._genRenderMesh()},onResizeWindow:function(t,e){this.windowSize={w:t,h:e};var i=Q.get();if(i&&i.design_size){var s=i.design_size.x,r=i.design_size.y;this._widgetRoot.setSize(s,r);var a=t/s,n=e/r;this._invRatio=Math.max(a,n),this._ratio=1/this._invRatio;var o=a>n?s:r*(t/e),h=a<n?r:s*(e/t);I.PMV_MATRIX.set(2/o,2/h,0,1),this._widgetRoot.setOffset(0,0),this._widgetRoot.setSize(o,h)}},onMouseDown:function(t,e){this._widgetRoot.captureEvent({type:Z,x:t*this._ratio,y:e*this._ratio})},onMouseUp:function(t,e){this._widgetRoot.captureEvent({type:q,x:t*this._ratio,y:e*this._ratio})},onMouseMove:function(t,e){this._widgetRoot.captureEvent({type:J,x:t*this._ratio,y:e*this._ratio})},onTouchStart:function(t){if(1===t.length){var e=t[0],i=e.x*this._ratio,s=e.y*this._ratio;this._widgetRoot.captureEvent({type:Z,x:i,y:s})}},onTouchEnd:function(t){if(1===t.length){var e=t[0],i=e.x*this._ratio,s=e.y*this._ratio;this._widgetRoot.captureEvent({type:q,x:i,y:s})}},onTouchMove:function(t){if(1===t.length){var e=t[0],i=e.x*this._ratio,s=e.y*this._ratio;this._widgetRoot.captureEvent({type:J,x:i,y:s})}},clone:function(){var t=this.getObjectByName("HALO2D");t&&this.remove(t);var e=(new this.constructor).copy(this,!0);e._widgets=this._widgets.slice(0);for(var i=0;i!==e._widgets.length;++i)e._widgetRoot.add(Q.createWidget(e._widgets[i]));return t&&this.add(t),e},encode:function(){var t=this.getObjectByName("HALO2D");t&&this.remove(t);var e=THREE.Object3D.prototype.encode.call(this);return null!==this.background&&(e.background=this.background.toJSON()),null!==this.fog&&(e.object.fog=this.fog.toJSON()),null!==this._widgets&&this._widgets.length>0&&(e.widgets=this._widgets),e.deps=this.getDeps(),et.uniqueDeps(e.deps),t&&this.add(t),e}}),Object.assign(I,{decode:function(t,e){if(void 0===e&&(e=new I),e.deps=t.deps,THREE.Object3D.decode(t,e),void 0!==t.background&&Number.isInteger(t.background)&&(e.background=new THREE.Color(t.background)),void 0!==t.fog&&("Fog"===t.fog.type?e.fog=new THREE.Fog(t.fog.color,t.fog.near,t.fog.far):"FogExp2"===t.fog.type&&(e.fog=new THREE.FogExp2(t.fog.color,t.fog.density))),void 0!==t.widgets){e._widgets=t.widgets;for(var i=0;i!==t.widgets.length;++i)e._widgetRoot.add(Q.createWidget(t.widgets[i]))}return e},PMV_MATRIX:new THREE.Vector4,materials:{},matqueue:[],SHADER_2D:{vertex:["attribute vec4 color;","uniform vec4 uPMVMatrix;","varying vec4 vColor;","varying vec2 vUV;","void main() {","    vColor = color;","    vUV = uv;","    vec4 pos = uPMVMatrix * vec4(position, 1.0);","    gl_Position = vec4(pos.x - 1.0, pos.y - 1.0, 0.0, 1.0);","}"].join("\n"),fragment:["varying vec4 vColor;","varying vec2 vUV;","uniform sampler2D tSprite;","void main() {","    gl_FragColor = texture2D(tSprite, vUV) * vColor;","}"].join("\n"),disabale:["varying vec4 vColor;","varying vec2 vUV;","uniform sampler2D tSprite;","void main() {","    vec4 color = texture2D(tSprite, vUV) * vColor;","    float gray = dot(color.rgb, vec3(0.3, 0.59, 0.11));","    gl_FragColor = vec4(gray, gray, gray, color.a);","}"].join("\n")}});var et=function(){var t=[],e=function(t){for(var e={},i=0;i!==t.length;){var s=t[i];if(s){var r=s.path+s.name;void 0===e[r]?(e[r]=s,++i):t.splice(i,1)}else t.splice(i,1)}},i=function(t,e){if(t instanceof Array)for(var i=0,s=t.length;i!==s;++i){var r=t[i];r.active&&t.uniforms.uTimer&&(r.uniforms.uTimer.value+=e)}else t.active&&t.uniforms.uTimer&&(t.uniforms.uTimer.value+=e)},s=function(t){for(var e={type:"Animation",clips:[],deps:[]},i=0,s=t.length;i!==s;++i){var r=t[i];e.clips.push(r.encode())}return e},r=function(t,e){var i;return void 0!==t.toDataURL?i=t:((i=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")).width=t.width,i.height=t.height,i.getContext("2d").drawImage(t,0,0,t.width,t.height)),"png"===(e?e.split(".").pop().toLowerCase():"png")?i.toDataURL("image/png"):i.toDataURL("image/jpeg",.6)};THREE.AnimationClip.prototype.encode=function(){for(var t=[],e=this.tracks,i={name:this.name,duration:this.duration,tracks:t,type:"AnimationClip"},s=0,r=e.length;s!==r;++s)t.push(THREE.KeyframeTrack.toJSON(e[s]));return i},THREE.Light.prototype.encode=function(){var t=THREE.Object3D.prototype.encode.call(this);return t.type=this.type,t.color=this.color.getHex(),t.intensity=this.intensity,void 0!==this.groundColor&&(t.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.distance=this.distance),void 0!==this.angle&&(t.angle=this.angle),void 0!==this.decay&&(t.decay=this.decay),void 0!==this.penumbra&&(t.penumbra=this.penumbra),void 0!==this.shadow&&(t.shadow=this.shadow.toJSON()),t},THREE.Light.prototype.decode=function(t){return THREE.Object3D.decode(t,this),t.shadow&&(this.shadow.bias=t.shadow.bias||0,this.shadow.radius=t.shadow.radius||1,this.shadow.mapSize.width=t.shadow.mapSize?t.shadow.mapSize[0]:512,this.shadow.mapSize.height=t.shadow.mapSize?t.shadow.mapSize[1]:512,this.shadow.camera.right=this.shadow.radius,this.shadow.camera.left=-this.shadow.radius,this.shadow.camera.top=this.shadow.radius,this.shadow.camera.bottom=-this.shadow.radius,this.shadow.camera.updateProjectionMatrix()),this},THREE.PerspectiveCamera.prototype.encode=function(){return THREE.Object3D.prototype.encode.call(this)},Object.assign(THREE.PerspectiveCamera,{decode:function(t){var e=new THREE.PerspectiveCamera;return THREE.Object3D.decode(t,e),e}}),THREE.Texture.prototype.getDeps=function(t){if(this.sourceFile&&""!==this.sourceFile){if(t){for(var e=[],i=0;i!=t.length;++i)"img"===t[i].path&&e.push(t[i].name);-1===e.indexOf(this.sourceFile)&&t.push({path:"img",name:this.sourceFile,raw:r(this.image,this.sourceFile)})}return{path:"img",name:this.sourceFile}}},THREE.Texture.prototype.encode=function(){var t={type:"Texture",name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],wrap:[this.wrapS,this.wrapT],minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,format:this.format};return void 0!==this.image&&this.sourceFile&&""!==this.sourceFile&&(t.image=this.sourceFile),t},Object.assign(THREE.Texture,{decode:function(t){var e=it.defaultTexture;return t.image&&((e=it.getObj("img",t.image)).name=t.name,e.mapping=t.mapping,e.repeat=new THREE.Vector2(t.repeat[0],t.repeat[1]),e.offset=new THREE.Vector2(t.offset[0],t.offset[1]),e.wrapS=t.wrap[0],e.wrapT=t.wrap[1],e.minFilter=t.minFilter,e.magFilter=t.magFilter,e.flipY=t.flipY,e.format=t.format,e.sourceFile=t.image,e.needsUpdate=!0),e}}),Object.assign(THREE.AnimationClip,{decode:function(t){for(var e=[],i=t.tracks,s=1/(t.fps||1),r=0,a=i.length;r!==a;++r)e.push(THREE.KeyframeTrack.parse(i[r]).scale(s));return new THREE.AnimationClip(t.name,t.duration,e)}}),THREE.Object3D.prototype.getDeps=function(t){for(var e=[],i=0,s=this.children.length;i!==s;++i){var r=this.children[i];"Group"===r.type?(e.splice(0,0,{path:"mdl",name:r.name}),t&&(t.push({path:"mdl",name:r.name,raw:r.encode()}),r.getDeps(t))):"Effect"===r.type||(e=r.getDeps(t).concat(e))}return e},THREE.Object3D.prototype.encode=function(){var t={type:this.type,uuid:this.uuid,matrix:this.matrix.toArray()};if(""!==this.name&&(t.name=this.name),!0===this.castShadow&&(t.castShadow=!0),!0===this.receiveShadow&&(t.receiveShadow=!0),!1===this.visible&&(t.visible=!1),this.func&&(t.func=this.func),this.children){t.children=[];for(var e=0,i=this.children.length;e!==i;++e){var s=this.children[e];"Group"===s.type||"Effect"===s.type?t.children.push({type:s.type,name:s.name,matrix:s.matrix.toArray()}):t.children.push(s.encode())}}return t},THREE.Object3D.prototype.update=function(t){this.fn_update&&this.fn_update(this);for(var e=0,i=this.children.length;e!==i;++e)this.children[e].update(t)},Object.assign(THREE.Object3D,{decode:function(t,e){if(void 0===e&&(e=new THREE.Object3D),e.uuid=t.uuid,e.matrix.fromArray(t.matrix),e.matrix.decompose(e.position,e.quaternion,e.scale),e.name=t.name,void 0!==t.castShadow&&(e.castShadow=t.castShadow),void 0!==t.receiveShadow&&(e.receiveShadow=t.receiveShadow),void 0!==t.visible&&(e.visible=t.visible),t.children)for(var i=0,s=t.children.length;i!==s;++i){var r=t.children[i];if("Group"===r.type){var a=it.getObj("mdl",r.name).clone();r.matrix&&(a.matrix.fromArray(r.matrix),a.matrix.decompose(a.position,a.quaternion,a.scale)),e.add(a)}else e.add(et.decode(r))}if(t.func_update){e.func_update=t.func_update;var n=Q.getFunc(t.func_update);n instanceof Function&&(e.fn_update=n)}if(t.func_init){e.func_init=t.func_init;var o=Q.getFunc(t.func_init);o instanceof Function&&o(e)}return e}}),THREE.Bone.prototype.encode=function(){var t={type:this.type,uuid:this.uuid,name:this.name,matrix:this.matrix.toArray()};if(this.children){t.children=[];for(var e=0,i=this.children.length;e!==i;++e){var s=this.children[e];t.children.push(s.encode())}}return t},Object.assign(THREE.Bone,{decode:function(t){var e=new THREE.Bone;if(e.uuid=t.uuid,e.matrix.fromArray(t.matrix),e.matrix.decompose(e.position,e.quaternion,e.scale),e.name=t.name,t.children)for(var i=0,s=t.children.length;i!==s;++i)e.add(et.decode(t.children[i]));return e}}),THREE.Group.prototype.getDeps=function(t){var i=THREE.Object3D.prototype.getDeps.call(this,t);return this.animations&&0!==this.animations.length&&"string"==typeof this.anim_name&&(i.splice(0,0,{path:"ani",name:this.anim_name}),t&&t.push({path:"ani",name:this.anim_name,raw:s(this.animations)})),t&&e(t),e(i),i},THREE.Group.prototype.play=function(t,e,i){var s=this.actions[t];return s.reset(),s.setLoop(e||THREE.LoopRepeat,i||1/0),s.play(),s},THREE.Group.prototype.stop=function(t){t?this.actions[t].stop():this.mixer.stopAllAction()},THREE.Group.prototype.encode=function(){var t={type:this.type,matrix:this.matrix.toArray()};if(this.children){t.children=[];for(var e=0,i=this.children.length;e!==i;++e){var s=this.children[e];t.children.push(s.encode())}}return this.skeleton&&(t.bones=!0),this.animations&&0!==this.animations.length&&"string"==typeof this.anim_name&&(t.anim_name=this.anim_name),!0===this.castShadow&&(t.castShadow=!0),!0===this.receiveShadow&&(t.receiveShadow=!0),!1===this.visible&&(t.visible=!1),t.deps=this.getDeps(),t},THREE.Group.prototype.update=function(t){THREE.Object3D.prototype.update.call(this,t),!this.pause&&this.mixer&&this.mixer.update(t)},THREE.Group.prototype.clone=function(){var t=THREE.Object3D.prototype.clone.call(this);if(this.skeleton&&(t.skeleton={bones:[]},t.traverse(function(e){t!==e&&t.skeleton.bones.push(e)}),t.traverse(function(e){if(e.isSkinnedMesh){var i=THREE.Skeleton.decode(t,e.skeleton.encode());e.bind(i,e.matrixWorld)}})),this.animations){t.mixer=new THREE.AnimationMixer(t),t.anim_name=this.anim_name,t.animations=this.animations,t.actions={};for(var e=0,i=t.animations.length;e!==i;++e){var s=t.animations[e];t.actions[s.name]=t.mixer.clipAction(s)}}return t},Object.assign(THREE.Group,{decode:function(e){var i=new THREE.Group;if(i.deps=e.deps,i.matrix.fromArray(e.matrix),i.matrix.decompose(i.position,i.quaternion,i.scale),void 0!==e.castShadow&&(i.castShadow=e.castShadow),void 0!==e.receiveShadow&&(i.receiveShadow=e.receiveShadow),void 0!==e.visible&&(i.visible=e.visible),e.children)for(var s=0;s<e.children.length;++s)i.add(et.decode(e.children[s]));e.bones&&(i.skeleton={bones:[]},i.traverse(function(t){i!==t&&i.skeleton.bones.push(t)}));for(var r=0;r<t.length;++r){var a=t[r],n=a.mesh,o=a.skeleton,h=THREE.Skeleton.decode(i,o);n.bind(h,n.matrixWorld)}if(t=[],e.anim_name){i.mixer=new THREE.AnimationMixer(i),i.anim_name=e.anim_name,i.animations=it.getObj("ani",e.anim_name),i.actions={};for(var c=0,l=i.animations.length;c!==l;++c){var d=i.animations[c];i.actions[d.name]=i.mixer.clipAction(d)}}return i}}),THREE.Mesh.prototype.getDeps=function(t){var e=THREE.Object3D.prototype.getDeps.call(this,t);if(Array.isArray(this.material))for(var i=0,s=this.material.length;i<s;i++){var r=this.material[i];e.splice(0,0,{path:"mat",name:r.name}),t&&(t.push({path:"mat",name:r.name,raw:r.encode()}),r.getDeps(t))}else e.splice(0,0,{path:"mat",name:this.material.name}),t&&(t.push({path:"mat",name:this.material.name,raw:this.material.encode()}),this.material.getDeps(t));return this.geometry&&this.geometry.isBufferGeometry&&(e.splice(0,0,{path:"geo",name:this.geometry.name}),t&&t.push({path:"geo",name:this.geometry.name,raw:this.geometry.encode()})),e},THREE.Mesh.prototype.encode=function(){var t=THREE.Object3D.prototype.encode.call(this);if(t.geometry=this.geometry.isBufferGeometry?this.geometry.name:this.geometry.encode(),Array.isArray(this.material)){t.material=[];for(var e=0,i=this.material.length;e<i;e++)t.material.push(this.material[e].name)}else t.material=this.material.name;return t},THREE.Mesh.prototype.update=function(t){i(this.material,t);for(var e=0,s=this.children.length;e!==s;++e)this.children[e].update(t)},Object.assign(THREE.Mesh,{decode:function(t,e){var i="string"==typeof t.geometry?it.getObj("geo",t.geometry):et.decode(t.geometry),s=null;if(Array.isArray(t.material)){s=[];for(var r=0,a=t.material.length;r!==a;++r)s.push(it.getObj("mat",t.material[r]))}else s=it.getObj("mat",t.material);return void 0===e?e=new THREE.Mesh(i,s||new THREE.MeshBasicMaterial):(e.material=s,e.geometry=i),THREE.Object3D.decode(t,e),e}}),THREE.SkinnedMesh.prototype.clone=function(){var t=new this.constructor(this.geometry,this.material).copy(this);return t.skeleton=this.skeleton,t},THREE.Bone.prototype.clone=function(t){var e=(new this.constructor).copy(this,t);return e.uuid=this.uuid,e},THREE.SkinnedMesh.prototype.encode=function(){var t=THREE.Mesh.prototype.encode.call(this);return this.skeleton&&(t.skeleton=this.skeleton.encode()),t},Object.assign(THREE.SkinnedMesh,{decode:function(e,i){var s="string"==typeof e.geometry?it.getObj("geo",e.geometry):et.decode(e.geometry),r=null;if(Array.isArray(e.material)){r=[];for(var a=0,n=e.material.length;a!==n;++a)r.push(it.getObj("mat",e.material[a]))}else r=it.getObj("mat",e.material);return void 0===i?i=new THREE.SkinnedMesh(s,r||new THREE.MeshBasicMaterial):(i.material=r,i.geometry=s),THREE.Object3D.decode(e,i),e.skeleton&&t.push({mesh:i,skeleton:e.skeleton}),i}}),THREE.Geometry.prototype.encode=function(){var t={};t.type="Geometry",t.shape=this.type,t.parameters=this.parameters,t.data={};var e=this.boundingSphere;return null!==e&&(t.data.boundingSphere={center:e.center.toArray(),radius:e.radius}),t},Object.assign(THREE.Geometry,{decode:function(t,e){if(!e){switch(t.shape){case"SphereGeometry":e=new THREE.SphereGeometry(t.parameters.radius,t.parameters.widthSegments,t.parameters.heightSegments);break;case"PlaneGeometry":e=new THREE.PlaneGeometry(t.parameters.width,t.parameters.height,t.parameters.widthSegments,t.parameters.heightSegments);break;default:e=new THREE.BoxGeometry(1,1,1)}e.name=t.shape}var i=t.data.boundingSphere;if(void 0!==i){var s=new THREE.Vector3;void 0!==i.center&&s.fromArray(i.center),e.boundingSphere=new THREE.Sphere(s,i.radius)}return e}}),THREE.BufferGeometry.prototype.encode=function(){var t={};if(t.type=this.type,void 0!==this.parameters){var e=this.parameters;for(var i in e)void 0!==e[i]&&(t[i]=e[i])}else{t.data={attributes:{}};var s=this.index;if(null!==s){n=Array.prototype.slice.call(s.array);t.data.index={type:s.array.constructor.name,array:n}}var r=this.attributes;for(var i in r){var a=r[i],n=Array.prototype.slice.call(a.array);t.data.attributes[i]={itemSize:a.itemSize,type:a.array.constructor.name,array:n,normalized:a.normalized}}var o=this.groups;o.length>0&&(t.data.groups=JSON.parse(JSON.stringify(o)));var h=this.boundingSphere;null!==h&&(t.data.boundingSphere={center:h.center.toArray(),radius:h.radius})}return t},Object.assign(THREE.BufferGeometry,{decode:function(t,e){var i={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};void 0===e&&(e=new THREE.BufferGeometry);var s=t.data.index;if(void 0!==s){o=new i[s.type](s.array);e.setIndex(new THREE.BufferAttribute(o,1))}var r=t.data.attributes;for(var a in r){var n=r[a],o=new i[n.type](n.array);e.addAttribute(a,new THREE.BufferAttribute(o,n.itemSize,n.normalized))}var h=t.data.groups||t.data.drawcalls||t.data.offsets;if(void 0!==h)for(var c=0,l=h.length;c!==l;++c){var d=h[c];e.addGroup(d.start,d.count,d.materialIndex)}var u=t.data.boundingSphere;if(void 0!==u){var p=new THREE.Vector3;void 0!==u.center&&p.fromArray(u.center),e.boundingSphere=new THREE.Sphere(p,u.radius)}return e}}),THREE.Skeleton.prototype.encode=function(){var t={bones:[],boneInverses:[]};if(this.bones){var e,i;for(e=0,i=this.bones.length;e<i;e++)t.bones.push(this.bones[e].uuid);for(e=0,i=this.boneInverses.length;e<i;++e){var s=this.boneInverses[e];t.boneInverses.push(s.toArray())}}return t},Object.assign(THREE.Skeleton,{decode:function(t,e){var i,s,r=[],a=[];for(i=0,s=e.bones.length;i<s;i++){var n=function(e){for(var i=0,s=t.skeleton.bones.length;i!=s;++i){var r=t.skeleton.bones[i];if(r.uuid===e)return r}return null}(e.bones[i]);null!==n&&r.push(n)}for(i=0,s=e.boneInverses.length;i<s;i++){var o=e.boneInverses[i],h=new THREE.Matrix4;h.fromArray(o),a.push(h)}return new THREE.Skeleton(r,a)}}),THREE.Material.prototype.getDeps=function(t){var e=[];return this.map&&this.map.isTexture&&e.push(this.map.getDeps(t)),this.alphaMap&&this.alphaMap.isTexture&&e.push(this.alphaMap.getDeps(t)),this.lightMap&&this.lightMap.isTexture&&e.push(this.lightMap.getDeps(t)),this.bumpMap&&this.bumpMap.isTexture&&e.push(this.bumpMap.getDeps(t)),this.normalMap&&this.normalMap.isTexture&&e.push(this.normalMap.getDeps(t)),this.displacementMap&&this.displacementMap.isTexture&&e.push(this.displacementMap.getDeps(t)),this.roughnessMap&&this.roughnessMap.isTexture&&e.push(this.roughnessMap.getDeps(t)),this.metalnessMap&&this.metalnessMap.isTexture&&e.push(this.metalnessMap.getDeps(t)),this.emissiveMap&&this.emissiveMap.isTexture&&e.push(this.emissiveMap.getDeps(t)),this.specularMap&&this.specularMap.isTexture&&e.push(this.specularMap.getDeps(t)),this.envMap&&this.envMap.isTexture&&e.push(this.envMap.getDeps(t)),this.gradientMap&&this.gradientMap.isTexture&&e.push(this.gradientMap.getDeps(t)),"ShaderMaterial"===this.type&&(this.isUVAnimMaterial?e.push(this.uniforms.tSprite.value.getDeps()):this.isUVFrameMaterial?e.push(this.uniforms.tSprite.value.getDeps()):this.isHaloMaterial&&e.push(this.uniforms.tSprite.value.getDeps())),e},THREE.Material.prototype.encode=function(){var t={type:this.type};return this.color&&this.color.isColor&&(t.color=this.color.getHex()),void 0!==this.roughness&&(t.roughness=this.roughness),void 0!==this.metalness&&(t.metalness=this.metalness),this.emissive&&this.emissive.isColor&&(t.emissive=this.emissive.getHex()),this.specular&&this.specular.isColor&&(t.specular=this.specular.getHex()),void 0!==this.shininess&&(t.shininess=this.shininess),void 0!==this.clearCoat&&(t.clearCoat=this.clearCoat),void 0!==this.clearCoatRoughness&&(t.clearCoatRoughness=this.clearCoatRoughness),this.map&&this.map.isTexture&&(t.map=this.map.encode()),this.alphaMap&&this.alphaMap.isTexture&&(t.alphaMap=this.alphaMap.encode()),this.lightMap&&this.lightMap.isTexture&&(t.lightMap=this.lightMap.encode()),this.bumpMap&&this.bumpMap.isTexture&&(t.bumpMap=this.bumpMap.encode(),t.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(t.normalMap=this.normalMap.encode(),t.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(t.displacementMap=this.displacementMap.encode(),t.displacementScale=this.displacementScale,t.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(t.roughnessMap=this.roughnessMap.encode()),this.metalnessMap&&this.metalnessMap.isTexture&&(t.metalnessMap=this.metalnessMap.encode()),this.emissiveMap&&this.emissiveMap.isTexture&&(t.emissiveMap=this.emissiveMap.encode()),this.specularMap&&this.specularMap.isTexture&&(t.specularMap=this.specularMap.encode()),this.envMap&&this.envMap.isTexture&&(t.reflectivity=this.reflectivity,t.envMap=this.envMap.encode()),this.gradientMap&&this.gradientMap.isTexture&&(t.gradientMap=this.gradientMap.encode()),void 0!==this.size&&(t.size=this.size),void 0!==this.sizeAttenuation&&(t.sizeAttenuation=this.sizeAttenuation),this.blending!==THREE.NormalBlending&&(t.blending=this.blending),this.shading!==THREE.SmoothShading&&(t.shading=this.shading),this.side!==THREE.FrontSide&&(t.side=this.side),this.vertexColors!==THREE.NoColors&&(t.vertexColors=this.vertexColors),this.opacity<1&&(t.opacity=this.opacity),!0===this.transparent&&(t.transparent=this.transparent),t.depthFunc=this.depthFunc,t.depthTest=this.depthTest,t.depthWrite=this.depthWrite,this.alphaTest>0&&(t.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(t.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(t.wireframe=this.wireframe),this.wireframeLinewidth>1&&(t.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(t.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(t.wireframeLinejoin=this.wireframeLinejoin),t.skinning=this.skinning,t.morphTargets=this.morphTargets,t.dithering=this.dithering,"ShaderMaterial"===this.type&&(this.isUVAnimMaterial?(t.shader="uv_animation",t.tSprite=this.uniforms.tSprite.value.encode(),t.uRepeat=this.uniforms.uRepeat.value.toArray(),t.uSpeed=this.uniforms.uSpeed.value.toArray()):this.isUVFrameMaterial?(t.shader="uv_frame",t.tSprite=this.uniforms.tSprite.value.encode(),t.uFrames=this.uniforms.uFrames.value,t.uCols=this.uniforms.uCols.value,t.uFPS=this.uniforms.uFPS.value):this.isHaloMaterial&&(t.shader="halo",t.tSprite=this.uniforms.tSprite.value.encode(),t.uDistance=this.uniforms.uDistance.value,t.uConst=this.uniforms.uConst.value,t.uPower=this.uniforms.uPower.value)),t.deps=this.getDeps(),e(t.deps),t};var a={ShadowMaterial:THREE.ShadowMaterial,SpriteMaterial:THREE.SpriteMaterial,RawShaderMaterial:THREE.RawShaderMaterial,ShaderMaterial:THREE.ShaderMaterial,PointsMaterial:THREE.PointsMaterial,MeshPhysicalMaterial:THREE.MeshPhysicalMaterial,MeshStandardMaterial:THREE.MeshStandardMaterial,MeshPhongMaterial:THREE.MeshPhongMaterial,MeshToonMaterial:THREE.MeshToonMaterial,MeshNormalMaterial:THREE.MeshNormalMaterial,MeshLambertMaterial:THREE.MeshLambertMaterial,MeshDepthMaterial:THREE.MeshDepthMaterial,MeshBasicMaterial:THREE.MeshBasicMaterial,LineDashedMaterial:THREE.LineDashedMaterial,LineBasicMaterial:THREE.LineBasicMaterial,Material:THREE.Material};return Object.assign(THREE.Material,{decode:function(t,e){if(e||("ShaderMaterial"===t.type?"uv_animation"===t.shader?((e=new O).uniforms.tSprite.value=et.decode(t.tSprite),e.uniforms.uRepeat.value.fromArray(t.uRepeat),e.uniforms.uSpeed.value.fromArray(t.uSpeed)):"uv_frame"===t.shader?((e=new D).uniforms.tSprite.value=et.decode(t.tSprite),e.uniforms.uFrames.value=t.uFrames,e.uniforms.uCols.value=t.uCols,e.uniforms.uFPS.value=t.uFPS):"halo"===t.shader?((e=new F).uniforms.tSprite.value=et.decode(t.tSprite),e.uniforms.uDistance.value=t.uDistance,e.uniforms.uConst.value=t.uConst,e.uniforms.uPower.value=t.uPower):e=new THREE.MeshBasicMaterial:e=new a[t.type]),e.deps=t.deps,void 0!==t.uuid&&(e.uuid=t.uuid),void 0!==t.color&&e.color.setHex(t.color),void 0!==t.roughness&&(e.roughness=t.roughness),void 0!==t.metalness&&(e.metalness=t.metalness),void 0!==t.emissive&&e.emissive.setHex(t.emissive),void 0!==t.specular&&e.specular.setHex(t.specular),void 0!==t.shininess&&(e.shininess=t.shininess),void 0!==t.clearCoat&&(e.clearCoat=t.clearCoat),void 0!==t.clearCoatRoughness&&(e.clearCoatRoughness=t.clearCoatRoughness),void 0!==t.uniforms&&(e.uniforms=t.uniforms),void 0!==t.vertexShader&&(e.vertexShader=t.vertexShader),void 0!==t.fragmentShader&&(e.fragmentShader=t.fragmentShader),void 0!==t.vertexColors&&(e.vertexColors=t.vertexColors),void 0!==t.fog&&(e.fog=t.fog),void 0!==t.shading&&(e.shading=t.shading),void 0!==t.blending&&(e.blending=t.blending),void 0!==t.side&&(e.side=t.side),void 0!==t.opacity&&(e.opacity=t.opacity),e.transparent=void 0!==t.transparent&&t.transparent,void 0!==t.alphaTest&&(e.alphaTest=t.alphaTest),void 0!==t.depthTest&&(e.depthTest=t.depthTest),void 0!==t.depthWrite&&(e.depthWrite=t.depthWrite),void 0!==t.colorWrite&&(e.colorWrite=t.colorWrite),void 0!==t.wireframe&&(e.wireframe=t.wireframe),void 0!==t.wireframeLinewidth&&(e.wireframeLinewidth=t.wireframeLinewidth),void 0!==t.wireframeLinecap&&(e.wireframeLinecap=t.wireframeLinecap),void 0!==t.wireframeLinejoin&&(e.wireframeLinejoin=t.wireframeLinejoin),void 0!==t.skinning&&(e.skinning=t.skinning),void 0!==t.morphTargets&&(e.morphTargets=t.morphTargets),void 0!==t.size&&(e.size=t.size),void 0!==t.sizeAttenuation&&(e.sizeAttenuation=t.sizeAttenuation),void 0!==t.map&&(e.map=et.decode(t.map)),void 0!==t.alphaMap&&(e.alphaMap=et.decode(t.alphaMap),e.transparent=!0),void 0!==t.bumpMap&&(e.bumpMap=et.decode(t.bumpMap)),void 0!==t.bumpScale&&(e.bumpScale=t.bumpScale),void 0!==t.normalMap&&(e.normalMap=et.decode(t.normalMap)),void 0!==t.normalScale){var i=t.normalScale;!1===Array.isArray(i)&&(i=[i,i]),e.normalScale=(new THREE.Vector2).fromArray(i)}return void 0!==t.displacementMap&&(e.displacementMap=et.decode(t.displacementMap)),void 0!==t.displacementScale&&(e.displacementScale=t.displacementScale),void 0!==t.displacementBias&&(e.displacementBias=t.displacementBias),void 0!==t.roughnessMap&&(e.roughnessMap=et.decode(t.roughnessMap)),void 0!==t.metalnessMap&&(e.metalnessMap=et.decode(t.metalnessMap)),void 0!==t.emissiveMap&&(e.emissiveMap=et.decode(t.emissiveMap)),void 0!==t.emissiveIntensity&&(e.emissiveIntensity=t.emissiveIntensity),void 0!==t.specularMap&&(e.specularMap=et.decode(t.specularMap)),void 0!==t.envMap&&(e.envMap=et.decode(t.envMap)),void 0!==t.reflectivity&&(e.reflectivity=t.reflectivity),void 0!==t.lightMap&&(e.lightMap=et.decode(t.lightMap)),void 0!==t.lightMapIntensity&&(e.lightMapIntensity=t.lightMapIntensity),void 0!==t.aoMap&&(e.aoMap=et.decode(t.aoMap)),void 0!==t.aoMapIntensity&&(e.aoMapIntensity=t.aoMapIntensity),void 0!==t.gradientMap&&(e.gradientMap=et.decode(t.gradientMap)),e}}),{decode:function(t){switch(t.type){case"Scene":return I.decode(t);case"Object3D":return THREE.Object3D.decode(t);case"Group":return THREE.Group.decode(t);case"Bone":return THREE.Bone.decode(t);case"Effect":return U.decode(t);case"AmbientLight":return(e=new THREE.AmbientLight(t.color,t.intensity)).decode(t);case"DirectionalLight":return(e=new THREE.DirectionalLight(t.color,t.intensity)).decode(t);case"PointLight":return(e=new THREE.PointLight(t.color,t.intensity,t.distance,t.decay)).decode(t);case"RectAreaLight":return(e=new THREE.RectAreaLight(t.color,t.intensity,t.width,t.height)).decode(t);case"SpotLight":return(e=new THREE.SpotLight(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay)).decode(t);case"HemisphereLight":var e=new THREE.HemisphereLight(t.color,t.groundColor,t.intensity);return e.decode(t);case"Mesh":return THREE.Mesh.decode(t);case"SkinnedMesh":return THREE.SkinnedMesh.decode(t);case"BufferGeometry":return THREE.BufferGeometry.decode(t);case"Geometry":return THREE.Geometry.decode(t);case"AnimationClip":return THREE.AnimationClip.decode(t);case"Animation":for(var i=[],s=0,r=t.clips.length;s!==r;++s)i.push(et.decode(t.clips[s]));return i;case"Texture":return THREE.Texture.decode(t);case"PerspectiveCamera":return new THREE.PerspectiveCamera.decode(t);default:if(a.hasOwnProperty(t.type))return THREE.Material.decode(t);console.error("ResourceParser can not find data type:",t.type)}return null},encodeAnimations:function(t){return s(t)},getDataURL:function(t,e){return r(t,e)},uniqueDeps:function(t){e(t)}}}(),it=function(){var t,e="";THREE.Texture.DEFAULT_IMAGE=document.createElementNS("http://www.w3.org/1999/xhtml","img"),THREE.Texture.DEFAULT_IMAGE.src="data:image/bmp;base64,Qk06AAAAAAAAADYAAAAoAAAAAQAAAP////8BACAAAAAAAAAAAAATCwAAEwsAAAAAAAAAAAAAACX//w==";var i={ani:{},scn:{},cfg:{},mat:{},mdl:{},img:{},geo:{},aud:{}},s={},r=new THREE.Texture(THREE.Texture.DEFAULT_IMAGE);r.needsUpdate=!0;var a=new THREE.MeshBasicMaterial({map:r}),n=new THREE.BoxGeometry(1,1,1),o=new x(r,"",0,1,1,1),h=new THREE.Mesh(n,a),c=new THREE.Group;c.add(h);var l={img:r,mat:a,geo:n,mdl:c,ani:[]},d=function(t,i){return""===i?e+t:""===t?e+i:"img"===t||"cfg"===t||"aud"===t?e+t+"/"+i:e+t+"/"+i+"."+t},u=function(t,e){var s=i[t][e];return void 0===s&&(s={name:e,path:t,raw:null,unzip:null,obj:null},i[t][e]=s),s},p=function(e){return new Promise(function(i,s){if(null===e.raw){var r=e.path,a=e.name;t(r,a,function(t){t?("scn"===r||"mdl"===r||"geo"===r||"mat"===r||"ani"===r?(e.raw=t,e.unzip=v(t)):"img"===r||"aud"===r?e.unzip=t:e.raw=e.unzip=t,i({r:e,s:1})):s({r:e,s:-1})})}else s({r:e,s:0})})},f=function(t,e){for(var i=0,s=t.length;i!=s;++i){var r=t[i].path,a=t[i].name,n=u(r,a);p(n).then(function(t){e(t.r,t.s)}).catch(function(t){e(t.r,t.s)})}},m=function(t,e){var i=u(t,e),s=null===i.obj?1:0;if(null===i.unzip){var r=l[t];r&&(i.obj="mdl"===t?r.clone():r)}else"scn"===t||"mdl"===t||"geo"===t||"mat"===t||"ani"===t?(i.obj=et.decode(i.unzip),i.obj.name=e):"img"===t?(i.obj=new THREE.Texture(i.unzip),i.obj.name=e,i.obj.sourceFile=e,i.obj.needsUpdate=!0):i.obj="aud"===t?i.unzip:JSON.parse(i.unzip);return s},v=function(t){var e=new JSZip(t,{base64:!0}),i=Object.keys(e.files),s=e.files[i[0]].asText();return JSON.parse(s)},g=null,y=0,E=function t(e,i){var s=e.slice(0),r=0,a=[];et.uniqueDeps(s),f(s,function(e,n){1===n&&(null===e.obj&&e.unzip&&e.unzip.deps&&(a=e.unzip.deps.concat(a)),g.unshift(e),callback(e,++y)),++r===s.length&&(a.length>0?t(a,i):i())})},b=function(t){for(var e=0,i=g.length;e!==i;++e){var s=g[e];1===m(s.path,s.name)&&t(s,++y)}t(null,0)};return{defaultTexture:r,defaultMaterial:a,defualtGeometry:n,defaultSimpleSprite:o,getSimpleAtlas:function(){return s},getUrl:function(t,e){return d(t,e)},unzip:function(t){return v(t)},setFileReader:function(e){t=e},setBaseUrl:function(t){e=t},clearCache:function(){i={ani:{},scn:{},cfg:{},mat:{},mdl:{},img:{},geo:{},aud:{}},s={}},getResType:function(t){return i[t]},clearResource:function(t,e){delete i[t][e]},getSimpleSprite:function(t,e){var i=s[t];if(i)return i[e]},parseSimpleAtlas:function(t,e){var r=i.cfg[t];if(r&&r.obj){var a=s[e]={},n=i.img[e].obj,o=1/n.image.width,h=1/n.image.height;for(var c in r.obj){var l=r.obj[c],d=new x(n,c,l.x*o,1-l.y*h,l.w*o,l.h*h);a[c]=d}}},getRes:function(t,e){return i[t][e]},getObj:function(t,e){var s=i[t][e];return s?(!s.obj&&s.unzip&&m(s.path,s.name),s.obj):null},addResource:function(t,e,i,s,r){var a=u(t,e);return a.obj=r||null,a.raw=i||null,a.unzip=s||null,a},parseRes:function(t,e){m(t,e)},loadData:function(t){return p(t)},loadList:function(t,e){y=0,g=[],E(t,function(){b(e)})}}}();t.version=null;var st=function(t,e,i){var s=it.getUrl(t,e);if("img"===t){var r=document.createElementNS("http://www.w3.org/1999/xhtml","img");r.onload=function(){i(r)},r.onerror=function(){i(null),console.log(""+s)},r.src=s}else{var a=new XMLHttpRequest;a.onreadystatechange=function(){a.readyState===XMLHttpRequest.DONE&&(200===a.status?i(a.responseText):(i(null),console.log(""+s)))},a.open("GET",s,!0),a.responseType="text",a.send()}},rt=function(e,i,s){var r=it.getUrl(e,i);Y.get(r,function(a){var n=t.version[e][i];n||console.error(e+":"+i+" miss version!");var o=n.version;if(void 0===a||o!==a.version)if("img"===e)(c=document.createElement("img")).onload=function(){var t=et.getDataURL(c,i);s(c),Y.set(r,t,o)},c.onerror=function(){s(null),console.log(""+r)},c.src=r;else if("aud"===e)(h=new XMLHttpRequest).onreadystatechange=function(){if(h.readyState===XMLHttpRequest.DONE)if(200===h.status){for(var t=new Uint8Array(h.response),e="",i=t.byteLength,a=0;a<i;a++)e+=String.fromCharCode(t[a]);var n="data:audio/"+r.split(".").pop().toLowerCase()+";base64,"+window.btoa(e),c=document.createElement("audio");c.src=n,s(c),Y.set(r,n,o)}else s(null),console.log(""+r)},h.open("GET",r,!0),h.responseType="arraybuffer",h.send();else{var h=new XMLHttpRequest;h.onreadystatechange=function(){h.readyState===XMLHttpRequest.DONE&&(200===h.status?(s(h.responseText),Y.set(r,h.responseText,o)):(s(null),console.log(""+r)))},h.open("GET",r,!0),h.responseType="text",h.send()}else if("img"===e){var c=document.createElement("img");c.src=a.data,s(c)}else if("aud"===e){var l=document.createElement("audio");l.src=a.data,s(l)}else s(a.data)})};P.prototype=Object.assign(Object.create(H.prototype),{constructor:P,isSprite2D:!0,getMatCfg:function(){return{enable:!0,scissorID:-1,texture:this._atlas.texture,srcFactor:this._srcFactor,dstFactor:this._dstFactor}},getVertexCount:function(){return 4},getIndexCount:function(){return 6},updatePosition:function(t,e){var i=this.transform.worldTransform,s=i.a,r=i.b,a=i.c,n=i.d,o=i.tx,h=i.ty,c=this._atlas.trim,l=this._atlas.orig,d=this._anchor,u=0,p=0,f=0,m=0,v=d.x*l.width,g=d.y*l.height;c?(p=c.min.x-v,u=c.max.x-v,m=c.min.y-g,f=c.max.y-g):(u=(p=-v)+l.width,f=(m=-g)+l.height);var y=s*p+a*m+o,x=n*m+r*p+h,E=s*u+a*m+o,b=n*m+r*u+h,w=s*u+a*f+o,_=n*f+r*u+h,T=s*p+a*f+o,R=n*f+r*p+h;t.setXYZ(e,y,x,0),t.setXYZ(e+1,E,b,0),t.setXYZ(e+2,w,_,0),t.setXYZ(e+3,T,R,0)},updateColor:function(t,e){var i=255*this.color.r,s=255*this.color.g,r=255*this.color.b,a=255*this.worldAlpha;t.setXYZW(e,i,s,r,a),t.setXYZW(e+1,i,s,r,a),t.setXYZW(e+2,i,s,r,a),t.setXYZW(e+3,i,s,r,a)},updateUV:function(t,e){this._atlas.updateUV(t,e)},updateIndex:function(t,e,i){t.array[e++]=i,t.array[e++]=i+1,t.array[e++]=i+2,t.array[e++]=i,t.array[e++]=i+2,t.array[e++]=i+3},render:function(t){if(this.visible&&this._atlas){t.push(this);for(var e=0,i=this.children.length;e<i;e++)this.children[e].render(t)}},setBlendMode:function(t,e){this._srcFactor=t,this._dstFactor=e}}),Object.defineProperty(P.prototype,"atlas",{get:function(){return this._atlas},set:function(t){this._atlas=t},enumerable:!0,configurable:!0}),t.Config=Q,t.TextCanvas=K,t.Effect=U,t.RendererBillboard=C,t.RendererBBArrow=z,t.ResourceManager=it,t.ResourceParser=et,t.Math=k,t.Matrix=M,t.Transform=S,t.HaloScene=I,t.Object2D=H,t.Atlas=function(t,e,i,s,r){this.texture=it.getObj("img",t),this._frame=e,this.trim=s,this.orig=i||this._frame,this._rotation=0;var a=65535/this.texture.image.width,n=65535/this.texture.image.height,o=this._frame.x*a,h=65535-this._frame.y*n,c=o+this._frame.width*a,l=h-this._frame.height*n;this.updateUV=function(t,e){t.setXY(e,o,l),t.setXY(e+1,c,l),t.setXY(e+2,c,h),t.setXY(e+3,o,h)}},t.SimpleSprite=x,t.Sprite2D=P,t.Widget=v,t.WtImage=g,t.WtButton=y,t.WtText=E,t.WtPanel=b,t.WtProgressBar=w,t.WtScrollView=_,t.WtGridView=T,t.WtDialog=R,t.WtObject2D=A,t.initVersion=V,t.loader=st,t.storageLoader=rt,t.init=function(e,i,s,r){var a=s||(e?rt:st);it.setBaseUrl(i),it.setFileReader(a),e?Y.init(e).then(function(){V().then(function(e){t.version=JSON.parse(e),(s||st)("","config.json",function(t){Q.init(JSON.parse(t),function(t){r&&r(t)})})})}):s?s("","config.json",function(t){Q.init(JSON.parse(t),function(t){r&&r(t)})}):r&&r(0)},t.encodeProject=function(){for(var t=[],e=["cfg","img","aud","geo","ani","mat","mdl","scn"],i=0;i!=e.length;++i){var s=e[i],r=it.getResType(s);for(var a in r)t.push({path:s,name:a,raw:r[a].raw})}return{cfg:Q.get(),wgt:Q.widgets(),eff:Q.effects(),res:t}},t.parseProject=function(t){for(o=0;o!==t.res.length;++o){var e=t.res[o].path,i=t.res[o].name,s=t.res[o].raw;if("scn"===e||"mdl"===e||"geo"===e||"mat"===e||"ani"===e){var r=it.unzip(s);it.addResource(e,i,s,r)}else if("img"===e){var a=document.createElement("img");a.src=s,it.addResource(e,i,s,a)}else if("aud"===e){var n=document.createElement("audio");n.src=s,it.addResource(e,i,s,n)}else it.addResource(e,i,s,s)}for(var o=0;o!==t.res.length;++o){var h=t.res[o];it.parseRes(h.path,h.name)}Q.initProject(t.cfg,t.wgt,t.eff)},t.DEFAULT_TEXTURE=L,t.ANCHOR_LEFT=G,t.ANCHOR_CENTER=2,t.ANCHOR_RIGHT=3,t.ANCHOR_TOP=N,t.ANCHOR_MIDDLE=5,t.ANCHOR_BOTTOM=6,t.EVT_UI_DOWN=Z,t.EVT_UI_UP=q,t.EVT_UI_MOVE=J,t.INITIALIZERS=B,t.AFFECTORS=W,t.MAX_REPEAT_DELAY=1e3,t.ParticleTemplate=m,t.ParticleSystem=X,t.UVAnimMaterial=O,t.UVFrameMaterial=D,t.HaloMaterial=F,Object.defineProperty(t,"__esModule",{value:!0})});
